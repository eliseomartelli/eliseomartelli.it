[
  {
    "title": "Modular applications in go",
    "excerpt": "Plugins, plugins, plugins.",
    "date": "2022-12-02T20:30:00.000Z",
    "tags": [
      "Programming",
      "Short"
    ],
    "body": {
      "raw": "\nI'm working on an unnamed application (I can't tell much about it now, but I will share more when I can) where I needed a way to load plugins dynamically based on the app's configuration.\n\nI concluded that I needed a way to \"store\" the plugins and load them based on the application configuration. It seems that the premise is akin to the \"registry\" pattern.\n\n## The registry\n\nTo have an O(1) time complexity, I decided to store plugins in a \"map\".\n\n```\n// Plugin registry.\nvar Plugins = map[string]Plugin{}\n```\n\nBut it doesn't automatically solve our problems. Golang offers an init function that gets called only when we first import a package. You can have any number of init functions inside a package (one per file, for example).\n\nSo the next idea is to use the init function to register our plugins.\n\n```\n// file plugin_name.go\npackage plugins\n\ntype PluginName struct {}\n\n...\n\nfunc init() {\n\tPlugins[\"plugin\"] = &PluginName{}\n}\n```\n\nWe already have a functioning proof-of-concept, but we can make it better!\n\n## Let it shine\n\nWe will define an interface for our plugins with some methods to manage the plugin life cycle.\n\n```\ntype Plugin interface {\n\tSetup()\n\tCleanup()\n}\n```\n\nThen I made a function to register a plugin into the register:\n\n```\n// Factory to provide a closure to get the Plugin.\ntype PluginFactory = func() Plugin\n\n// Register SHOULD BE called by the init() function of a plugin.\n// The provider will be added to the Plugin map.\nfunc Register(pluginName string, plugin PluginFactory) {\n\tif _, present := Plugins[pluginName]; present {\n\t\tlog.Fatalf(\"Plugin %s already defined.\", pluginName)\n\t}\n\tPlugins[pluginName] = plugin\n}\n```\n\nWe have to change our previous plugin to use this function:\n\n```\n// file plugin_name.go\n\nfunc init() {\n\tRegister(\"plugin\", func() Provider { return &PluginName{} })\n\n}\n```\n\n## Consuming the plugin\n\nTo use the plugins, we can, for example, iterate on a list of configured plugins, check if they're available in the map, and call the life cycle method to set them up.\n\n```\nfor _, pluginName := range configuredPlugins {\n\tif plugin, present := Plugins[pluginName]; present {\n\t\tplugin.Setup()\n\t}\n}\n```\n\nWe now have the tools to build a modular application in go.\n",
      "code": "var Component=(()=>{var g=Object.create;var a=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var f=(i,n)=>()=>(n||i((n={exports:{}}).exports,n),n.exports),y=(i,n)=>{for(var t in n)a(i,t,{get:n[t],enumerable:!0})},o=(i,n,t,r)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let l of d(n))!m.call(i,l)&&l!==t&&a(i,l,{get:()=>n[l],enumerable:!(r=s(n,l))||r.enumerable});return i};var P=(i,n,t)=>(t=i!=null?g(h(i)):{},o(n||!i||!i.__esModule?a(t,\"default\",{value:i,enumerable:!0}):t,i)),w=i=>o(a({},\"__esModule\",{value:!0}),i);var u=f((N,c)=>{c.exports=_jsx_runtime});var _={};y(_,{default:()=>v,frontmatter:()=>b});var e=P(u()),b={title:\"Modular applications in go\",date:\"2022-12-02 21:30\",excerpt:\"Plugins, plugins, plugins.\",tags:[\"Programming\",\"Short\"]};function p(i){let n=Object.assign({p:\"p\",h2:\"h2\",pre:\"pre\",code:\"code\"},i.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"I'm working on an unnamed application (I can't tell much about it now, but I will share more when I can) where I needed a way to load plugins dynamically based on the app's configuration.\"}),`\n`,(0,e.jsx)(n.p,{children:'I concluded that I needed a way to \"store\" the plugins and load them based on the application configuration. It seems that the premise is akin to the \"registry\" pattern.'}),`\n`,(0,e.jsx)(n.h2,{children:\"The registry\"}),`\n`,(0,e.jsx)(n.p,{children:'To have an O(1) time complexity, I decided to store plugins in a \"map\".'}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`// Plugin registry.\nvar Plugins = map[string]Plugin{}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"But it doesn't automatically solve our problems. Golang offers an init function that gets called only when we first import a package. You can have any number of init functions inside a package (one per file, for example).\"}),`\n`,(0,e.jsx)(n.p,{children:\"So the next idea is to use the init function to register our plugins.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`// file plugin_name.go\npackage plugins\n\ntype PluginName struct {}\n\n...\n\nfunc init() {\n\tPlugins[\"plugin\"] = &PluginName{}\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"We already have a functioning proof-of-concept, but we can make it better!\"}),`\n`,(0,e.jsx)(n.h2,{children:\"Let it shine\"}),`\n`,(0,e.jsx)(n.p,{children:\"We will define an interface for our plugins with some methods to manage the plugin life cycle.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`type Plugin interface {\n\tSetup()\n\tCleanup()\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"Then I made a function to register a plugin into the register:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`// Factory to provide a closure to get the Plugin.\ntype PluginFactory = func() Plugin\n\n// Register SHOULD BE called by the init() function of a plugin.\n// The provider will be added to the Plugin map.\nfunc Register(pluginName string, plugin PluginFactory) {\n\tif _, present := Plugins[pluginName]; present {\n\t\tlog.Fatalf(\"Plugin %s already defined.\", pluginName)\n\t}\n\tPlugins[pluginName] = plugin\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"We have to change our previous plugin to use this function:\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`// file plugin_name.go\n\nfunc init() {\n\tRegister(\"plugin\", func() Provider { return &PluginName{} })\n\n}\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Consuming the plugin\"}),`\n`,(0,e.jsx)(n.p,{children:\"To use the plugins, we can, for example, iterate on a list of configured plugins, check if they're available in the map, and call the life cycle method to set them up.\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`for _, pluginName := range configuredPlugins {\n\tif plugin, present := Plugins[pluginName]; present {\n\t\tplugin.Setup()\n\t}\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"We now have the tools to build a modular application in go.\"})]})}function x(i={}){let{wrapper:n}=i.components||{};return n?(0,e.jsx)(n,Object.assign({},i,{children:(0,e.jsx)(p,i)})):p(i)}var v=x;return w(_);})();\n;return Component;"
    },
    "_id": "blog/02-12-2022-gomodular.md",
    "_raw": {
      "sourceFilePath": "blog/02-12-2022-gomodular.md",
      "sourceFileName": "02-12-2022-gomodular.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/02-12-2022-gomodular"
    },
    "type": "Post",
    "url": "blog/02-12-2022-gomodular",
    "timeToRead": "2"
  },
  {
    "title": "On: solutions",
    "excerpt": "A great master must be a great teacher",
    "date": "2023-04-05T19:30:00.000Z",
    "tags": [
      "Studies",
      "Short"
    ],
    "body": {
      "raw": "\nLast week I got stuck on a reverse engineering exercise (using GDB to analyze memory content is a lot of fun. The solution was changing the choice of the starting offset from where to start to view the memory. I was reading \"no-sense\" instructions, and I felt stuck).\n\nI talked to the course teacher, and he didn't provide an immediate solution. He just told me to keep it simple. At that time, I felt even more frustrated. In theory, the steps I was taking were correct. I was missing a little piece.\n\nYesterday I finally solved the exercise, and I remembered a quote from a book I read last month:\n\n> ...I once asked him why the Master had looked on so long at my futile efforts to draw the bow “spiritually” why he had not insisted on the correct breathing right from the the start. “A great Master”, he replied, “must also be a great teacher. ...Had he begun the lessons with breathing exercises, he would never have been able to convince you that you owe them anything decisive. You had to suffer shipwreck through your own efforts before you were ready to seize the lifebelt he threw you. ...\n>\n> <cite>from:\n> Zen in the Art of Archery -\n> Eugen Herrigel</cite>\n\nHad he told me immediately what I was missing, I could've concluded the exercise quickly, there's no doubt, but I would've completely missed the lesson that, sometimes, it's best to have a more expansive vision of the problem and that in many instances, answers are indeed simple.\n",
      "code": "var Component=(()=>{var d=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),p=(t,e)=>{for(var o in e)r(t,o,{get:e[o],enumerable:!0})},i=(t,e,o,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of u(e))!g.call(t,s)&&s!==o&&r(t,s,{get:()=>e[s],enumerable:!(a=m(e,s))||a.enumerable});return t};var y=(t,e,o)=>(o=t!=null?d(f(t)):{},i(e||!t||!t.__esModule?r(o,\"default\",{value:t,enumerable:!0}):o,t)),b=t=>i(r({},\"__esModule\",{value:!0}),t);var c=w((_,h)=>{h.exports=_jsx_runtime});var v={};p(v,{default:()=>k,frontmatter:()=>x});var n=y(c()),x={title:\"On: solutions\",date:\"2023-04-05 21:30\",excerpt:\"A great master must be a great teacher\",tags:[\"Studies\",\"Short\"]};function l(t){let e=Object.assign({p:\"p\",blockquote:\"blockquote\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:'Last week I got stuck on a reverse engineering exercise (using GDB to analyze memory content is a lot of fun. The solution was changing the choice of the starting offset from where to start to view the memory. I was reading \"no-sense\" instructions, and I felt stuck).'}),`\n`,(0,n.jsx)(e.p,{children:\"I talked to the course teacher, and he didn't provide an immediate solution. He just told me to keep it simple. At that time, I felt even more frustrated. In theory, the steps I was taking were correct. I was missing a little piece.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Yesterday I finally solved the exercise, and I remembered a quote from a book I read last month:\"}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"...I once asked him why the Master had looked on so long at my futile efforts to draw the bow \\u201Cspiritually\\u201D why he had not insisted on the correct breathing right from the the start. \\u201CA great Master\\u201D, he replied, \\u201Cmust also be a great teacher. ...Had he begun the lessons with breathing exercises, he would never have been able to convince you that you owe them anything decisive. You had to suffer shipwreck through your own efforts before you were ready to seize the lifebelt he threw you. ...\"}),`\n`,(0,n.jsx)(\"cite\",{children:`from:\nZen in the Art of Archery -\nEugen Herrigel`}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Had he told me immediately what I was missing, I could've concluded the exercise quickly, there's no doubt, but I would've completely missed the lesson that, sometimes, it's best to have a more expansive vision of the problem and that in many instances, answers are indeed simple.\"})]})}function I(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(l,t)})):l(t)}var k=I;return b(v);})();\n;return Component;"
    },
    "_id": "blog/05-04-2023-masters.md",
    "_raw": {
      "sourceFilePath": "blog/05-04-2023-masters.md",
      "sourceFileName": "05-04-2023-masters.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/05-04-2023-masters"
    },
    "type": "Post",
    "url": "blog/05-04-2023-masters",
    "timeToRead": "1"
  },
  {
    "title": "The joy of photography in the age of social media",
    "excerpt": "The value of taking pictures for yourself, and the importance of sharing them intentionally",
    "date": "2022-12-07T20:30:00.000Z",
    "tags": [
      "Photography",
      "Short"
    ],
    "body": {
      "raw": "\nI was listening to a podcast about street photography, and the presenter mentioned Vivian Maier.  \nIf you don't know Vivian Maier, she was a street photographer from New York City who was active in the mid-20th century.  \nHer pictures, never published during her life, were discovered by some collectors and later published.  \nHer work is candid, intimate, and powerful. She had an innate ability to capture moments and emotions on the streets.\n\nI think that, as humans, we are fortunate to be able to see her work now. If we think about it, she took photos only for herself.\n\nThat's what I want back from my photography.\n\nI was talking to buddying photographers ([@\\_\\_the_street](https://instagram.com/__the_street) and [@sacks](https://instagram.com/sacks), both of them met on the internet, about battling with the Instagram algorithm.\n\nAs someone who enjoys sharing my work with people (yeah, maybe I'm chasing feedback, I recognize that), it can be highly frustrating to battle against the algorithm. It's unpredictable and designed to boost the in-app engagement of the particular platform. Publishing high-quality content is often not enough, and often, your posts get ignored and never shown to people.\n\nFor example, right now, Instagram is pushing Reels to its users. Short and engaging videos that keep people scrolling for the daily dopamine boost.\n\nIt's hard to compete for attention on a platform that doesn't prioritize stills anymore.\n\nIn my opinion, there will be a renaissance of printing.  \nPhysical media is one of the ways to share your work with others. It doesn't rely on obscure social media algorithms. It's completely analog. In the end, it makes you more intentional with your work.\n\nAnother way of sharing pictures I'm exploring it's via this website. It gives me complete control over how I show my work to people and retain community aspects.\n\nThe algorithm is not always evil. Abandoning Instagram could limit your ability to engage with that community and potentially reduce the visibility of your work.\n\nInstagram's main problem is that it incentivizes people that \"play by the rules\".  \nBut why should I post what people are expecting? I don't want to scroll through an endless feed of similar content. I want uniqueness.\n\nMy end goal is to produce work that matters, work that is meaningful. Ultimately I should care less about numbers and more about how I can create connections through my work.  \nNumbers and metrics are not the only measure of success or value.\n",
      "code": "var Component=(()=>{var p=Object.create;var r=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),w=(n,e)=>{for(var o in e)r(n,o,{get:e[o],enumerable:!0})},s=(n,e,o,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of d(e))!u.call(n,a)&&a!==o&&r(n,a,{get:()=>e[a],enumerable:!(i=m(e,a))||i.enumerable});return n};var b=(n,e,o)=>(o=n!=null?p(g(n)):{},s(e||!n||!n.__esModule?r(o,\"default\",{value:n,enumerable:!0}):o,n)),f=n=>s(r({},\"__esModule\",{value:!0}),n);var l=y((j,h)=>{h.exports=_jsx_runtime});var x={};w(x,{default:()=>v,frontmatter:()=>I});var t=b(l()),I={title:\"The joy of photography in the age of social media\",date:\"2022-12-07 21:30\",excerpt:\"The value of taking pictures for yourself, and the importance of sharing them intentionally\",tags:[\"Photography\",\"Short\"]};function c(n){let e=Object.assign({p:\"p\",br:\"br\",a:\"a\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"I was listening to a podcast about street photography, and the presenter mentioned Vivian Maier.\",(0,t.jsx)(e.br,{}),`\n`,\"If you don't know Vivian Maier, she was a street photographer from New York City who was active in the mid-20th century.\",(0,t.jsx)(e.br,{}),`\n`,\"Her pictures, never published during her life, were discovered by some collectors and later published.\",(0,t.jsx)(e.br,{}),`\n`,\"Her work is candid, intimate, and powerful. She had an innate ability to capture moments and emotions on the streets.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"I think that, as humans, we are fortunate to be able to see her work now. If we think about it, she took photos only for herself.\"}),`\n`,(0,t.jsx)(e.p,{children:\"That's what I want back from my photography.\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"I was talking to buddying photographers (\",(0,t.jsx)(e.a,{href:\"https://instagram.com/__the_street\",children:\"@__the_street\"}),\" and \",(0,t.jsx)(e.a,{href:\"https://instagram.com/sacks\",children:\"@sacks\"}),\", both of them met on the internet, about battling with the Instagram algorithm.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"As someone who enjoys sharing my work with people (yeah, maybe I'm chasing feedback, I recognize that), it can be highly frustrating to battle against the algorithm. It's unpredictable and designed to boost the in-app engagement of the particular platform. Publishing high-quality content is often not enough, and often, your posts get ignored and never shown to people.\"}),`\n`,(0,t.jsx)(e.p,{children:\"For example, right now, Instagram is pushing Reels to its users. Short and engaging videos that keep people scrolling for the daily dopamine boost.\"}),`\n`,(0,t.jsx)(e.p,{children:\"It's hard to compete for attention on a platform that doesn't prioritize stills anymore.\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"In my opinion, there will be a renaissance of printing.\",(0,t.jsx)(e.br,{}),`\n`,\"Physical media is one of the ways to share your work with others. It doesn't rely on obscure social media algorithms. It's completely analog. In the end, it makes you more intentional with your work.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"Another way of sharing pictures I'm exploring it's via this website. It gives me complete control over how I show my work to people and retain community aspects.\"}),`\n`,(0,t.jsx)(e.p,{children:\"The algorithm is not always evil. Abandoning Instagram could limit your ability to engage with that community and potentially reduce the visibility of your work.\"}),`\n`,(0,t.jsxs)(e.p,{children:[`Instagram's main problem is that it incentivizes people that \"play by the rules\".`,(0,t.jsx)(e.br,{}),`\n`,\"But why should I post what people are expecting? I don't want to scroll through an endless feed of similar content. I want uniqueness.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"My end goal is to produce work that matters, work that is meaningful. Ultimately I should care less about numbers and more about how I can create connections through my work.\",(0,t.jsx)(e.br,{}),`\n`,\"Numbers and metrics are not the only measure of success or value.\"]})]})}function k(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(c,n)})):c(n)}var v=k;return f(x);})();\n;return Component;"
    },
    "_id": "blog/07-12-2022-photostruggles.md",
    "_raw": {
      "sourceFilePath": "blog/07-12-2022-photostruggles.md",
      "sourceFileName": "07-12-2022-photostruggles.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/07-12-2022-photostruggles"
    },
    "type": "Post",
    "url": "blog/07-12-2022-photostruggles",
    "timeToRead": "2"
  },
  {
    "title": "The economic impact of LLMs",
    "excerpt": "A great master must be a great teacher",
    "date": "2023-04-11T19:30:00.000Z",
    "tags": [
      "Misc",
      "Short"
    ],
    "body": {
      "raw": "\nLarge language models such as generative pre-trained transformers (GPTs) are in full bloom, with researchers developing, testing, and refining systems with capabilities spanning various domains [[1]](#1).\n\nTechnological evolution brought these tools to a broader than-ever audience. In a modern office type-setting, it's increasingly normal to see someone interacting with AI tools like ChatGPT.\n\n### References\n\n<a id=\"1\">[1]</a>\nSparks of Artificial General Intelligence: Early experiments with GPT-4  \n<a id=\"2\">[2]</a>\nGPTs are GPTs: An Early Look at the Labor Market Impact Potential of Large Language Models\n",
      "code": "var Component=(()=>{var g=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var u=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),b=(n,e)=>{for(var r in e)i(n,r,{get:e[r],enumerable:!0})},o=(n,e,r,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of m(e))!f.call(n,a)&&a!==r&&i(n,a,{get:()=>e[a],enumerable:!(s=d(e,a))||s.enumerable});return n};var x=(n,e,r)=>(r=n!=null?g(p(n)):{},o(e||!n||!n.__esModule?i(r,\"default\",{value:n,enumerable:!0}):r,n)),L=n=>o(i({},\"__esModule\",{value:!0}),n);var l=u((G,c)=>{c.exports=_jsx_runtime});var _={};b(_,{default:()=>T,frontmatter:()=>j});var t=x(l()),j={title:\"The economic impact of LLMs\",date:\"2023-04-11 21:30\",excerpt:\"A great master must be a great teacher\",tags:[\"Misc\",\"Short\"]};function h(n){let e=Object.assign({p:\"p\",a:\"a\",h3:\"h3\",br:\"br\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"Large language models such as generative pre-trained transformers (GPTs) are in full bloom, with researchers developing, testing, and refining systems with capabilities spanning various domains \",(0,t.jsx)(e.a,{href:\"#1\",children:\"[1]\"}),\".\"]}),`\n`,(0,t.jsx)(e.p,{children:\"Technological evolution brought these tools to a broader than-ever audience. In a modern office type-setting, it's increasingly normal to see someone interacting with AI tools like ChatGPT.\"}),`\n`,(0,t.jsx)(e.h3,{children:\"References\"}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(\"a\",{id:\"1\",children:\"[1]\"}),`\nSparks of Artificial General Intelligence: Early experiments with GPT-4`,(0,t.jsx)(e.br,{}),`\n`,(0,t.jsx)(\"a\",{id:\"2\",children:\"[2]\"}),`\nGPTs are GPTs: An Early Look at the Labor Market Impact Potential of Large Language Models`]})]})}function M(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(h,n)})):h(n)}var T=M;return L(_);})();\n;return Component;"
    },
    "_id": "blog/11-04-2023-llm-economics.md",
    "_raw": {
      "sourceFilePath": "blog/11-04-2023-llm-economics.md",
      "sourceFileName": "11-04-2023-llm-economics.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/11-04-2023-llm-economics"
    },
    "type": "Post",
    "url": "blog/11-04-2023-llm-economics",
    "timeToRead": "1"
  },
  {
    "title": "Music streaming sucks, long live music streaming.",
    "excerpt": "DRM & bass.",
    "date": "2022-11-24T20:30:00.000Z",
    "tags": [
      "Music",
      "Short"
    ],
    "body": {
      "raw": "\nThe evolution of portable, personal, and on-demand music started in 1979 thanks to Sony with their Walkman (ウォークマン), after about 20 years of pocket radios.\nThe Walkman then evolved into Discman (and similar devices), and at the beginning of the 2000s, the digital audio revolution came and brought Mp3 players, most notably the iPod.\n\nWe are currently in the post-iPod era. The smartphone is the primary device most people use to listen to and consume audio content.\n\nThe always-connected smartphone brought new industries into the tech space. One of these industries is streaming.\n\n## Is music streaming worth the money? (for me)\n\nAccordingly to my (highly scientific) method, I've listened to about 1000 songs this year, organized into about 500 albums and singles.\n\nConsidering a more sane music listening habit not skewed by the streaming culture, I would've bought ten albums in a year. At this time of the year, I would've spent €100 on music, considering a price of €10 for a single album.\n\nWith streaming, I pay around half the price of that. With that, I get\nhuman-curated content like \"Apple Music Today\";\nalgorithmic recommendations;\nand shared playlists.\nThen, I don't need to manage a media server, I don't need to worry about ripping media, and I get high-quality streaming.\n\nDRM sucks, yes. But contrary to video streaming, the quantity of music I listen to is orders of magnitude larger than the video content I watch. It makes sense economically in my case.\n\nLong live music streaming.\n",
      "code": "var Component=(()=>{var m=Object.create;var o=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),f=(t,e)=>{for(var i in e)o(t,i,{get:e[i],enumerable:!0})},r=(t,e,i,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of u(e))!p.call(t,a)&&a!==i&&o(t,a,{get:()=>e[a],enumerable:!(s=l(e,a))||s.enumerable});return t};var b=(t,e,i)=>(i=t!=null?m(g(t)):{},r(e||!t||!t.__esModule?o(i,\"default\",{value:t,enumerable:!0}):i,t)),v=t=>r(o({},\"__esModule\",{value:!0}),t);var h=y((j,c)=>{c.exports=_jsx_runtime});var k={};f(k,{default:()=>x,frontmatter:()=>I});var n=b(h()),I={title:\"Music streaming sucks, long live music streaming.\",date:\"2022-11-24 21:30\",excerpt:\"DRM & bass.\",tags:[\"Music\",\"Short\"]};function d(t){let e=Object.assign({p:\"p\",h2:\"h2\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:`The evolution of portable, personal, and on-demand music started in 1979 thanks to Sony with their Walkman (\\u30A6\\u30A9\\u30FC\\u30AF\\u30DE\\u30F3), after about 20 years of pocket radios.\nThe Walkman then evolved into Discman (and similar devices), and at the beginning of the 2000s, the digital audio revolution came and brought Mp3 players, most notably the iPod.`}),`\n`,(0,n.jsx)(e.p,{children:\"We are currently in the post-iPod era. The smartphone is the primary device most people use to listen to and consume audio content.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The always-connected smartphone brought new industries into the tech space. One of these industries is streaming.\"}),`\n`,(0,n.jsx)(e.h2,{children:\"Is music streaming worth the money? (for me)\"}),`\n`,(0,n.jsx)(e.p,{children:\"Accordingly to my (highly scientific) method, I've listened to about 1000 songs this year, organized into about 500 albums and singles.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Considering a more sane music listening habit not skewed by the streaming culture, I would've bought ten albums in a year. At this time of the year, I would've spent \\u20AC100 on music, considering a price of \\u20AC10 for a single album.\"}),`\n`,(0,n.jsx)(e.p,{children:`With streaming, I pay around half the price of that. With that, I get\nhuman-curated content like \"Apple Music Today\";\nalgorithmic recommendations;\nand shared playlists.\nThen, I don't need to manage a media server, I don't need to worry about ripping media, and I get high-quality streaming.`}),`\n`,(0,n.jsx)(e.p,{children:\"DRM sucks, yes. But contrary to video streaming, the quantity of music I listen to is orders of magnitude larger than the video content I watch. It makes sense economically in my case.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Long live music streaming.\"})]})}function w(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(d,t)})):d(t)}var x=w;return v(k);})();\n;return Component;"
    },
    "_id": "blog/24-11-2022-music-services.md",
    "_raw": {
      "sourceFilePath": "blog/24-11-2022-music-services.md",
      "sourceFileName": "24-11-2022-music-services.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/24-11-2022-music-services"
    },
    "type": "Post",
    "url": "blog/24-11-2022-music-services",
    "timeToRead": "1"
  },
  {
    "title": "My photography journey",
    "excerpt": "Something that clicks",
    "date": "2022-11-25T18:40:00.000Z",
    "tags": [
      "Photography",
      "Short"
    ],
    "body": {
      "raw": "\nPhotography is certainly not a new thing for me. I started taking snapshots of the things around me when Adobe Photoshop CS4 was still around with a compact digital camera which I received as a gift when my relatives saw my interest in photography. Before that, I had a plastic-lens compact film camera.\n\nPhotography was always something \"latent\" in my life. I didn't put lots of thought into that art.\nTo be fair: I had the basis of composition, knowledge of the exposure triangle, and maybe some lucky shots here and there.\nI didn't have a photography genre that caught my interest, and some other things in my life filled the \"mental bandwidth\" I could dedicate to photography.\n\nI then moved to Turin from a small town in Abruzzo. At that moment, something kicked in.\nSuddenly, I started to pay attention to colors, shapes, and light around me, and I felt the need to capture what I was seeing, the moments around me.\n\nOne of the first things I bought after moving was a DSLR camera. It was a commitment, something I had on my shelf that reminded me of taking some pictures here and there.\nThe most important thing was regaining confidence with that tool and slowly taking some steps into the world with that shiny new toy.\n\nWith that new toy, I started taking pictures of landmarks around the city (yeah, I'm not proud of every photo I took, but some came out lucky, and I still like them to this day). There's a limited number of landmarks in a city, and it started to become boring. I was worried about the money I spent on something that didn't give me the joy I was expecting. Then something clicked (pun intended).\nWhat if I had people as subjects?\n\nThat was the bloom of what I'm photographing today. I took pictures of people in urban typesettings, but something didn't feel right.\nWhat was I doing? What \"story\" am I trying to tell?\nIt turns out that people only have a pre-defined set of actions they do in public, at least here in Turin. I had to find another way to keep shooting.\n\nAt this point, I started seeing photography in another light. What I had was this tool that allowed me to capture the interaction between light and objects. What if I used this interaction as the subject of my pictures?\nMy current iteration is keeping individuals anonymized by the environment, using existing light to provide contrast in the parts I want to highlight. I started to produce darker images, and, for now, this is my happy place.\n\nI still have a lot to learn about this art. I'm pretty confident that the practice of taking pictures is here to stay for me. I share my photos on Instagram Stories at the moment, but I want to build an archive on this site as soon as possible.\n\nI'm curious about what will be my next step.\n",
      "code": "var Component=(()=>{var l=Object.create;var i=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),f=(e,t)=>{for(var o in t)i(e,o,{get:t[o],enumerable:!0})},s=(e,t,o,h)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let a of p(t))!u.call(e,a)&&a!==o&&i(e,a,{get:()=>t[a],enumerable:!(h=c(t,a))||h.enumerable});return e};var w=(e,t,o)=>(o=e!=null?l(g(e)):{},s(t||!e||!e.__esModule?i(o,\"default\",{value:e,enumerable:!0}):o,e)),I=e=>s(i({},\"__esModule\",{value:!0}),e);var d=y((T,r)=>{r.exports=_jsx_runtime});var v={};f(v,{default:()=>x,frontmatter:()=>b});var n=w(d()),b={title:\"My photography journey\",date:\"2022-11-25 19:40\",excerpt:\"Something that clicks\",tags:[\"Photography\",\"Short\"]};function m(e){let t=Object.assign({p:\"p\"},e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:\"Photography is certainly not a new thing for me. I started taking snapshots of the things around me when Adobe Photoshop CS4 was still around with a compact digital camera which I received as a gift when my relatives saw my interest in photography. Before that, I had a plastic-lens compact film camera.\"}),`\n`,(0,n.jsx)(t.p,{children:`Photography was always something \"latent\" in my life. I didn't put lots of thought into that art.\nTo be fair: I had the basis of composition, knowledge of the exposure triangle, and maybe some lucky shots here and there.\nI didn't have a photography genre that caught my interest, and some other things in my life filled the \"mental bandwidth\" I could dedicate to photography.`}),`\n`,(0,n.jsx)(t.p,{children:`I then moved to Turin from a small town in Abruzzo. At that moment, something kicked in.\nSuddenly, I started to pay attention to colors, shapes, and light around me, and I felt the need to capture what I was seeing, the moments around me.`}),`\n`,(0,n.jsx)(t.p,{children:`One of the first things I bought after moving was a DSLR camera. It was a commitment, something I had on my shelf that reminded me of taking some pictures here and there.\nThe most important thing was regaining confidence with that tool and slowly taking some steps into the world with that shiny new toy.`}),`\n`,(0,n.jsx)(t.p,{children:`With that new toy, I started taking pictures of landmarks around the city (yeah, I'm not proud of every photo I took, but some came out lucky, and I still like them to this day). There's a limited number of landmarks in a city, and it started to become boring. I was worried about the money I spent on something that didn't give me the joy I was expecting. Then something clicked (pun intended).\nWhat if I had people as subjects?`}),`\n`,(0,n.jsx)(t.p,{children:`That was the bloom of what I'm photographing today. I took pictures of people in urban typesettings, but something didn't feel right.\nWhat was I doing? What \"story\" am I trying to tell?\nIt turns out that people only have a pre-defined set of actions they do in public, at least here in Turin. I had to find another way to keep shooting.`}),`\n`,(0,n.jsx)(t.p,{children:`At this point, I started seeing photography in another light. What I had was this tool that allowed me to capture the interaction between light and objects. What if I used this interaction as the subject of my pictures?\nMy current iteration is keeping individuals anonymized by the environment, using existing light to provide contrast in the parts I want to highlight. I started to produce darker images, and, for now, this is my happy place.`}),`\n`,(0,n.jsx)(t.p,{children:\"I still have a lot to learn about this art. I'm pretty confident that the practice of taking pictures is here to stay for me. I share my photos on Instagram Stories at the moment, but I want to build an archive on this site as soon as possible.\"}),`\n`,(0,n.jsx)(t.p,{children:\"I'm curious about what will be my next step.\"})]})}function k(e={}){let{wrapper:t}=e.components||{};return t?(0,n.jsx)(t,Object.assign({},e,{children:(0,n.jsx)(m,e)})):m(e)}var x=k;return I(v);})();\n;return Component;"
    },
    "_id": "blog/25-11-2022-cameras.md",
    "_raw": {
      "sourceFilePath": "blog/25-11-2022-cameras.md",
      "sourceFileName": "25-11-2022-cameras.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/25-11-2022-cameras"
    },
    "type": "Post",
    "url": "blog/25-11-2022-cameras",
    "timeToRead": "2"
  },
  {
    "title": "Web3 isn't for me",
    "excerpt": "You wouldn't funge a token",
    "date": "2022-11-26T18:40:00.000Z",
    "tags": [
      "Misc",
      "Short"
    ],
    "body": {
      "raw": "\nWhenever I read around the web terms like crypto, web3 or nft, the blanket of pure skepticism covers my eyes, and I can't stop myself from asking questions about the subject.\n\nThe shift of ownership to the users, arguably the only point of interest of Web3, is just an afterthought and a promise, so people buy the latest shitcoin.\nThe term itself is a money-mover, a way for VC to gather cash fast from enthusiasts.\n\nThe vision presented by the crypto-enthusiast is at the edge of dystopia, and sometimes it becomes _religious_.\n\nMy criticism of Web3 is mainly on the crypto/nft side. Decentralization, on the other end, is a great concept and something that already exists in various forms.\n\nBitTorrent, for instance, is an example of decentralization. It has been around for at least 20 years without any signs of cryptocurrency.\nOther examples are ActivityPub, IPFS, ...\n\n\"Cryptobros\" usually call me a hater, but I can't see the class of problems this technology is supposed to solve.\nWeb3 became the umbrella term for the gamification/reification of everything around us.\n",
      "code": "var Component=(()=>{var m=Object.create;var r=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),b=(t,e)=>{for(var s in e)r(t,s,{get:e[s],enumerable:!0})},i=(t,e,s,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let o of f(e))!d.call(t,o)&&o!==s&&r(t,o,{get:()=>e[o],enumerable:!(a=u(e,o))||a.enumerable});return t};var g=(t,e,s)=>(s=t!=null?m(p(t)):{},i(e||!t||!t.__esModule?r(s,\"default\",{value:t,enumerable:!0}):s,t)),x=t=>i(r({},\"__esModule\",{value:!0}),t);var h=y((I,c)=>{c.exports=_jsx_runtime});var _={};b(_,{default:()=>w,frontmatter:()=>j});var n=g(h()),j={title:\"Web3 isn't for me\",date:\"2022-11-26 19:40\",excerpt:\"You wouldn't funge a token\",tags:[\"Misc\",\"Short\"]};function l(t){let e=Object.assign({p:\"p\",em:\"em\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"Whenever I read around the web terms like crypto, web3 or nft, the blanket of pure skepticism covers my eyes, and I can't stop myself from asking questions about the subject.\"}),`\n`,(0,n.jsx)(e.p,{children:`The shift of ownership to the users, arguably the only point of interest of Web3, is just an afterthought and a promise, so people buy the latest shitcoin.\nThe term itself is a money-mover, a way for VC to gather cash fast from enthusiasts.`}),`\n`,(0,n.jsxs)(e.p,{children:[\"The vision presented by the crypto-enthusiast is at the edge of dystopia, and sometimes it becomes \",(0,n.jsx)(e.em,{children:\"religious\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"My criticism of Web3 is mainly on the crypto/nft side. Decentralization, on the other end, is a great concept and something that already exists in various forms.\"}),`\n`,(0,n.jsx)(e.p,{children:`BitTorrent, for instance, is an example of decentralization. It has been around for at least 20 years without any signs of cryptocurrency.\nOther examples are ActivityPub, IPFS, ...`}),`\n`,(0,n.jsx)(e.p,{children:`\"Cryptobros\" usually call me a hater, but I can't see the class of problems this technology is supposed to solve.\nWeb3 became the umbrella term for the gamification/reification of everything around us.`})]})}function v(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(l,t)})):l(t)}var w=v;return x(_);})();\n;return Component;"
    },
    "_id": "blog/26-11-2022-cryptobros.md",
    "_raw": {
      "sourceFilePath": "blog/26-11-2022-cryptobros.md",
      "sourceFileName": "26-11-2022-cryptobros.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/26-11-2022-cryptobros"
    },
    "type": "Post",
    "url": "blog/26-11-2022-cryptobros",
    "timeToRead": "1"
  },
  {
    "title": "Using Ansible to deploy IoT devices",
    "excerpt": "Blending two automation platforms to bring some sanity to the IoT world.",
    "date": "2020-03-10T00:00:00.000Z",
    "tags": [
      "Automation",
      "Ansible",
      "IoT"
    ],
    "body": {
      "raw": "\nThis article is going to show you how an existing tool intended for completely different purposes can be used to automate the boring task of manually setting up and **mantain a fleet of IoT devices.**  \nFor those of you who don't know what [**Ansible**](https://www.ansible.com/) is, Ansible is an automation platform made for enterprises and for those in need of managing a big set of devices, usually servers.\n\n## Getting our feet wet with Ansible\n\nAnsible revolves around the concept of [_Infrastructure as Code_](https://en.wikipedia.org/wiki/Infrastructure_as_code) and provides a set of tools to manage said infrastructure.  \nOne advantage of pursuing to keep our configurations within Ansible is the ability to reproduce builds (configurations, in our case).\n\n## Ansible's basic concepts\n\nFor the sake of simplicity, we're going to focus on **4 core concepts:**\n\n1. Playbooks\n2. Tasks\n3. Modules\n4. Inventory\n\n### Playbooks\n\nAn Ansible Playbook is a YAML file that **describes** the state of the devices involved in the configuration and what tasks should be done.\n\n### Tasks\n\nTasks in Ansible are the **actions** that will be executed.  \nThey run sequentially.\n\n### Modules\n\nModules are used in tasks and they express the **\"type\" of action** that should be executed.\n\n### Inventory\n\nAn inventory is a file that contains the hosts and the **groups** that should be targeted by our tasks.\n\nAfter this little introduction, let's get to it!\n\n## Prerequisites\n\nTo follow this tutorial you need at least one device with [**Tasmota**](https://tasmota.github.io/) already connected to our WiFi network (preferably with a fixed IP address).  \nYou also need a computer with **Python** and **git** installed.\n\n## Installing Ansible\n\nInstalling Ansible is quite easy, many Linux distributions have it inside their repositories, you can also use **pip**, and type this tiny command:\n\n```bash\npip install ansible\n```\n\n## Creating an inventory\n\nTo create an inventory you should create an _inventory_ file and then edit it with your preferred file editor.\n\nAn example file will look something like that:\n\n```\n[plugs]\n192.168.0.10\n\n[lights]\n192.168.0.11\n```\n\nAs you can see we use square brackets to define host groups.\n\n### Using the inventory to store variables\n\nAnother great feature of the inventory is the ability to **store variables** that can be used inside tasks.\n\n```\n[plugs]\n192.168.0.10    friendly_name=\"Bathroom Fan\"\n\n[lights]\n192.168.0.11    friendly_name=\"Kitchen Downlight\"\n```\n\n## Setup the Tasmota integration\n\nSince Tasmota is not the typical use of Ansible we need to install a custom role to use the two systems together.\n\nThe role we're going to use today is Tobias Richter's [\"Tasmota\"](https://galaxy.ansible.com/tobias_richter/tasmota).\n\nThe command to install this role is:\n\n```bash\nansible-galaxy install tobias_richter.tasmota\n```\n\n## Writing the playbook\n\nNow it's time to write the playbook!  \nCreate a new file named _playbook.yaml_ and then open it with your file editor.  \nNow we have to create our first _play._\n\nWe start by defining the group of hosts we want to target and then we have to disable the _gather_facts_ function, as for the [documentation](https://github.com/tobias-richter/ansible-tasmota#fact-gathering) of the custom role.\n\n```yaml\n- hosts: all\n  gather_facts: no\n```\n\nWe can now create our first task and give it a name:\n\n```yaml\ntasks:\n  - name: Ensure device reports status\n```\n\nNext, we have to define what module we're going to use. For this custom role, we have to use the _include_role_ module.  \nOur task will become something like that:\n\n```yaml\ntasks:\n  - name: Ensure device reports status\n    include_role:\n      name: ansible-tasmota\n```\n\nNow it's time to **define** the command we're going to send to our devices.  \nEdit your task as follows:\n\n```yaml\ntasks:\n  - name: Ensure device is present\n    include_role:\n      name: ansible-tasmota\n    vars:\n      tasmota_commands:\n        - command: Status\n```\n\nThe resulting _playbook.yaml_ will look like this:\n\n```yaml\n- hosts: all\n  gather_facts: no\n  tasks:\n    - name: Ensure device is present\n      include_role:\n        name: ansible-tasmota\n      vars:\n        tasmota_commands:\n          - command: Status\n```\n\nNow we can run our playbook like this:\n\n```bash\nansible-playbook -i inventory playbook.yaml\n```\n\nYou can use this as a base to create more complex playbooks.\n\n## Another example\n\nLet's say we want to configure the MQTT connection of our devices, we can use a playbook that looks something like this:\n\n```yaml\n- hosts: all\n  gather_facts: no\n  vars_files:\n    - default.yaml\n  tasks:\n    - name: Ensure template is set\n      include_role:\n        name: ansible-tasmota\n      vars:\n        - name: Ensure mqtt configuration is present\n          include_role:\n            name: ansible-tasmota\n          vars:\n            tasmota_commands:\n              - command: Backlog\n                value: \"mqttuser <mqttuser>; mqttpassword <mqttpass>; mqttport 1883; mqtthost <mqtthost>;\"\n```\n\nAs you can see, using Ansible to **configure** a fleet of Tasmota devices is an **easy** task to setup and will help you manage your growing collection of smart devices in the long run.\n",
      "code": "var Component=(()=>{var d=Object.create;var o=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),f=(t,e)=>{for(var i in e)o(t,i,{get:e[i],enumerable:!0})},r=(t,e,i,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of m(e))!p.call(t,a)&&a!==i&&o(t,a,{get:()=>e[a],enumerable:!(s=u(e,a))||s.enumerable});return t};var y=(t,e,i)=>(i=t!=null?d(g(t)):{},r(e||!t||!t.__esModule?o(i,\"default\",{value:t,enumerable:!0}):i,t)),w=t=>r(o({},\"__esModule\",{value:!0}),t);var h=b((T,l)=>{l.exports=_jsx_runtime});var A={};f(A,{default:()=>_,frontmatter:()=>k});var n=y(h()),k={title:\"Using Ansible to deploy IoT devices\",date:\"2020-03-10\",excerpt:\"Blending two automation platforms to bring some sanity to the IoT world.\",tags:[\"Automation\",\"Ansible\",\"IoT\"]};function c(t){let e=Object.assign({p:\"p\",strong:\"strong\",br:\"br\",a:\"a\",h2:\"h2\",em:\"em\",ol:\"ol\",li:\"li\",h3:\"h3\",pre:\"pre\",code:\"code\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"This article is going to show you how an existing tool intended for completely different purposes can be used to automate the boring task of manually setting up and \",(0,n.jsx)(e.strong,{children:\"mantain a fleet of IoT devices.\"}),(0,n.jsx)(e.br,{}),`\n`,\"For those of you who don't know what \",(0,n.jsx)(e.a,{href:\"https://www.ansible.com/\",children:(0,n.jsx)(e.strong,{children:\"Ansible\"})}),\" is, Ansible is an automation platform made for enterprises and for those in need of managing a big set of devices, usually servers.\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Getting our feet wet with Ansible\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Ansible revolves around the concept of \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Infrastructure_as_code\",children:(0,n.jsx)(e.em,{children:\"Infrastructure as Code\"})}),\" and provides a set of tools to manage said infrastructure.\",(0,n.jsx)(e.br,{}),`\n`,\"One advantage of pursuing to keep our configurations within Ansible is the ability to reproduce builds (configurations, in our case).\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Ansible's basic concepts\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"For the sake of simplicity, we're going to focus on \",(0,n.jsx)(e.strong,{children:\"4 core concepts:\"})]}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Playbooks\"}),`\n`,(0,n.jsx)(e.li,{children:\"Tasks\"}),`\n`,(0,n.jsx)(e.li,{children:\"Modules\"}),`\n`,(0,n.jsx)(e.li,{children:\"Inventory\"}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{children:\"Playbooks\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"An Ansible Playbook is a YAML file that \",(0,n.jsx)(e.strong,{children:\"describes\"}),\" the state of the devices involved in the configuration and what tasks should be done.\"]}),`\n`,(0,n.jsx)(e.h3,{children:\"Tasks\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Tasks in Ansible are the \",(0,n.jsx)(e.strong,{children:\"actions\"}),\" that will be executed.\",(0,n.jsx)(e.br,{}),`\n`,\"They run sequentially.\"]}),`\n`,(0,n.jsx)(e.h3,{children:\"Modules\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Modules are used in tasks and they express the \",(0,n.jsx)(e.strong,{children:'\"type\" of action'}),\" that should be executed.\"]}),`\n`,(0,n.jsx)(e.h3,{children:\"Inventory\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"An inventory is a file that contains the hosts and the \",(0,n.jsx)(e.strong,{children:\"groups\"}),\" that should be targeted by our tasks.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After this little introduction, let's get to it!\"}),`\n`,(0,n.jsx)(e.h2,{children:\"Prerequisites\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"To follow this tutorial you need at least one device with \",(0,n.jsx)(e.a,{href:\"https://tasmota.github.io/\",children:(0,n.jsx)(e.strong,{children:\"Tasmota\"})}),\" already connected to our WiFi network (preferably with a fixed IP address).\",(0,n.jsx)(e.br,{}),`\n`,\"You also need a computer with \",(0,n.jsx)(e.strong,{children:\"Python\"}),\" and \",(0,n.jsx)(e.strong,{children:\"git\"}),\" installed.\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Installing Ansible\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Installing Ansible is quite easy, many Linux distributions have it inside their repositories, you can also use \",(0,n.jsx)(e.strong,{children:\"pip\"}),\", and type this tiny command:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`pip install ansible\n`})}),`\n`,(0,n.jsx)(e.h2,{children:\"Creating an inventory\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"To create an inventory you should create an \",(0,n.jsx)(e.em,{children:\"inventory\"}),\" file and then edit it with your preferred file editor.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"An example file will look something like that:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`[plugs]\n192.168.0.10\n\n[lights]\n192.168.0.11\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"As you can see we use square brackets to define host groups.\"}),`\n`,(0,n.jsx)(e.h3,{children:\"Using the inventory to store variables\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Another great feature of the inventory is the ability to \",(0,n.jsx)(e.strong,{children:\"store variables\"}),\" that can be used inside tasks.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`[plugs]\n192.168.0.10    friendly_name=\"Bathroom Fan\"\n\n[lights]\n192.168.0.11    friendly_name=\"Kitchen Downlight\"\n`})}),`\n`,(0,n.jsx)(e.h2,{children:\"Setup the Tasmota integration\"}),`\n`,(0,n.jsx)(e.p,{children:\"Since Tasmota is not the typical use of Ansible we need to install a custom role to use the two systems together.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The role we're going to use today is Tobias Richter's \",(0,n.jsx)(e.a,{href:\"https://galaxy.ansible.com/tobias_richter/tasmota\",children:'\"Tasmota\"'}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The command to install this role is:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`ansible-galaxy install tobias_richter.tasmota\n`})}),`\n`,(0,n.jsx)(e.h2,{children:\"Writing the playbook\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now it's time to write the playbook!\",(0,n.jsx)(e.br,{}),`\n`,\"Create a new file named \",(0,n.jsx)(e.em,{children:\"playbook.yaml\"}),\" and then open it with your file editor.\",(0,n.jsx)(e.br,{}),`\n`,\"Now we have to create our first \",(0,n.jsx)(e.em,{children:\"play.\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We start by defining the group of hosts we want to target and then we have to disable the \",(0,n.jsx)(e.em,{children:\"gather_facts\"}),\" function, as for the \",(0,n.jsx)(e.a,{href:\"https://github.com/tobias-richter/ansible-tasmota#fact-gathering\",children:\"documentation\"}),\" of the custom role.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`- hosts: all\n  gather_facts: no\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"We can now create our first task and give it a name:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`tasks:\n  - name: Ensure device reports status\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, we have to define what module we're going to use. For this custom role, we have to use the \",(0,n.jsx)(e.em,{children:\"include_role\"}),\" module.\",(0,n.jsx)(e.br,{}),`\n`,\"Our task will become something like that:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`tasks:\n  - name: Ensure device reports status\n    include_role:\n      name: ansible-tasmota\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now it's time to \",(0,n.jsx)(e.strong,{children:\"define\"}),\" the command we're going to send to our devices.\",(0,n.jsx)(e.br,{}),`\n`,\"Edit your task as follows:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`tasks:\n  - name: Ensure device is present\n    include_role:\n      name: ansible-tasmota\n    vars:\n      tasmota_commands:\n        - command: Status\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The resulting \",(0,n.jsx)(e.em,{children:\"playbook.yaml\"}),\" will look like this:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`- hosts: all\n  gather_facts: no\n  tasks:\n    - name: Ensure device is present\n      include_role:\n        name: ansible-tasmota\n      vars:\n        tasmota_commands:\n          - command: Status\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"Now we can run our playbook like this:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`ansible-playbook -i inventory playbook.yaml\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"You can use this as a base to create more complex playbooks.\"}),`\n`,(0,n.jsx)(e.h2,{children:\"Another example\"}),`\n`,(0,n.jsx)(e.p,{children:\"Let's say we want to configure the MQTT connection of our devices, we can use a playbook that looks something like this:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`- hosts: all\n  gather_facts: no\n  vars_files:\n    - default.yaml\n  tasks:\n    - name: Ensure template is set\n      include_role:\n        name: ansible-tasmota\n      vars:\n        - name: Ensure mqtt configuration is present\n          include_role:\n            name: ansible-tasmota\n          vars:\n            tasmota_commands:\n              - command: Backlog\n                value: \"mqttuser <mqttuser>; mqttpassword <mqttpass>; mqttport 1883; mqtthost <mqtthost>;\"\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"As you can see, using Ansible to \",(0,n.jsx)(e.strong,{children:\"configure\"}),\" a fleet of Tasmota devices is an \",(0,n.jsx)(e.strong,{children:\"easy\"}),\" task to setup and will help you manage your growing collection of smart devices in the long run.\"]})]})}function v(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(c,t)})):c(t)}var _=v;return w(A);})();\n;return Component;"
    },
    "_id": "blog/ansible_tasmota.md",
    "_raw": {
      "sourceFilePath": "blog/ansible_tasmota.md",
      "sourceFileName": "ansible_tasmota.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/ansible_tasmota"
    },
    "type": "Post",
    "url": "blog/ansible_tasmota",
    "timeToRead": "4"
  },
  {
    "title": "IoT device segregation on EdgeOS",
    "excerpt": "VLANs? VLANs. Get to know how to segregate chatty IoT devices on your network",
    "date": "2020-09-14T00:00:00.000Z",
    "tags": [
      "Network",
      "IoT"
    ],
    "body": {
      "raw": "\n![Network Equipment](https://p0.pikist.com/photos/309/174/network-equipment-hardware-internet-data-server-communication-connection-datacenter.jpg)\n\nHaving a good firewall in place when building a home network is something that now is more important than ever. Traditionally, home firewalls were made to **protect** the internal **local network** from connection that could originate from the internet (That's what you expect from an ISP provided modem/router combo). In this day and age, thanks to the **fast rise** of **smart home** gadgets, our home networks are becoming more and more occupied by little computers usually running firmware that is **not possible to check** or manage. A firewall can help us mitigate the [potential issues](https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=upnp) that can occur by using this kind of devices.\n\nThe intent of this article is to provide a **sensible** baseline **configuration** that you can expand to suit your own needs. These concepts can be applied on a variety of SOHO routers (check yor router for VLAN tagging support and firewall capabilities between different networks).\n\nThe router I've chosen to use for this post is the small and mighty [**Ubiquiti EdgeRouter X**](https://amzn.to/2FtPBv9), a five port router that's plenty capable of handling a medium-to-large home network without _breaking the bank_. This router runs a fork of Vyatta called **EdgeOS** as the stock operating system.\nI've paired this device with a [**Unifi Access Point**](https://amzn.to/2DXEkm6) to satisfy all my Wi-Fi needs.\n\n## High-level overview\n\nThe steps you need to take care of are the following:\n\n1. **Create** a new **virtual interface** and assing it an IP address;\n2. **Attach** the virtual interface to an ethernet port;\n3. **Setup a firewall** to isolate this new interface from the rest of your network.\n\n## EdgeOS specific configuration\n\nTo configure the EdgeRouter we are going to use the CLI. We are going to **start** a configuration session by typing \"configure\" into the shell.\n\n1. **Create** a network group that targets [**RFC1918**](https://tools.ietf.org/html/rfc1918) networks:\n\n```bash\nset firewall group network-group RFC1918 description 'RFC1918 ranges'\nset firewall group network-group RFC1918 network 192.168.0.0/16\nset firewall group network-group RFC1918 network 172.16.0.0/12\nset firewall group network-group RFC1918 network 10.0.0.0/8\n```\n\n2. Setup the firewall to **block** traffic to RFC1918 networks but allow DNS and DHCP:\n\n```bash\nset firewall name IOT_IN_LOCAL default-action accept\nset firewall name IOT_IN_LOCAL description 'IOT In and Local ruleset.'\n```\n\n2.1 We are going to **allow established and related** network traffic so that we can access the IOT devices from other networks.\n\n```bash\nset firewall name IOT_IN_LOCAL rule 10 action accept\nset firewall name IOT_IN_LOCAL rule 10 description 'allow established/related'\nset firewall name IOT_IN_LOCAL rule 10 protocol all\nset firewall name IOT_IN_LOCAL rule 10 state established enable\nset firewall name IOT_IN_LOCAL rule 10 state related enable\n```\n\n2.2 We can't forget to allow **DHCP** requests so that our devices can get an IP address.\nIt might be useful to allow **DNS** requests originating from our IOT VLAN too.\n\n```bash\nset firewall name IOT_IN_LOCAL rule 20 action accept\nset firewall name IOT_IN_LOCAL rule 20 description 'Allow DNS'\nset firewall name IOT_IN_LOCAL rule 20 destination port 53\nset firewall name IOT_IN_LOCAL rule 20 protocol tcp_udp\n\nset firewall name IOT_IN_LOCAL rule 30 action accept\nset firewall name IOT_IN_LOCAL rule 30 description 'Allow DHCP'\nset firewall name IOT_IN_LOCAL rule 30 destination port 67\nset firewall name IOT_IN_LOCAL rule 30 protocol udp\n```\n\n2.3 The last firewall rule we are going to setup is the one that **blocks** traffic going to our other private network(s).\n\n```bash\nset firewall name IOT_IN_LOCAL rule 40 action drop\nset firewall name IOT_IN_LOCAL rule 40 description 'Drop RFC1918'\nset firewall name IOT_IN_LOCAL rule 40 destination group network-group RFC1918\nset firewall name IOT_IN_LOCAL rule 40 protocol all\n```\n\n3. **Create** a new **virtual interface** for the VLAN intended to be used by our IOT devices:\n\n```bash\nset interfaces ethernet eth1 vif 32 address 10.0.32.1/24\nset interfaces ethernet eth1 vif 32 description IOT_VLAN\nset interfaces ethernet eht1 vif 32 mtu 1500\n```\n\n4. **Assign** the firewall ruleset to the _in_ and _local_ sides of the firewall.\n\n```bash\nset interfaces ethernet eth1 vif 32 firewall in name IOT_IN_LOCAL\nset interfaces ethernet eth1 vif 32 firewall local name IOT_IN_LOCAL\n```\n\n5. Setup the **DHCP** server to listen to the requests coming from the new VLAN:\n\n```bash\nset service dhcp-server shared-network-name IOT_VLAN authoritative disable\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 default-router 10.0.32.1\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 dns-server 10.0.32.1\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 lease 86499\nset service dhcp-server shared-network-name IOT_VLAN start 10.0.32.10 stop 10.0.32.100\n```\n\n6. Setup the **DNS** forwarder to listen on this virtual interface:\n\n```bash\nset service dns forwarding listen-on eth1.32\n```\n\n7. Configure the **mDNS repeater** to enable mDNS resolution from our other networks (useful for devices like the Chromecast).\n\n```bash\nset service mdns repeater interface eth1\nset service mdns repeater interface eth1.32\n```\n\n8. **Save** your configuration with \"commit\" and then \"save\".\n\nAt this point you should now have a new VLAN that cannot see your other networks but can still access the internet.\n\n---\n\n_Disclosure: this post contains one (or more) affiliate link. If you buy something through one of those links you won't pay anything more but I'll get a small commission that helps me mantaining this blog._\n",
      "code": "var Component=(()=>{var d=Object.create;var o=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var m=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),w=(t,e)=>{for(var r in e)o(t,r,{get:e[r],enumerable:!0})},l=(t,e,r,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of u(e))!f.call(t,i)&&i!==r&&o(t,i,{get:()=>e[i],enumerable:!(a=g(e,i))||a.enumerable});return t};var I=(t,e,r)=>(r=t!=null?d(p(t)):{},l(e||!t||!t.__esModule?o(r,\"default\",{value:t,enumerable:!0}):r,t)),O=t=>l(o({},\"__esModule\",{value:!0}),t);var c=m((b,s)=>{s.exports=_jsx_runtime});var N={};w(N,{default:()=>v,frontmatter:()=>L});var n=I(c()),L={title:\"IoT device segregation on EdgeOS\",date:\"2020-09-14\",excerpt:\"VLANs? VLANs. Get to know how to segregate chatty IoT devices on your network\",tags:[\"Network\",\"IoT\"]};function h(t){let e=Object.assign({p:\"p\",img:\"img\",strong:\"strong\",a:\"a\",em:\"em\",h2:\"h2\",ol:\"ol\",li:\"li\",pre:\"pre\",code:\"code\",hr:\"hr\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://p0.pikist.com/photos/309/174/network-equipment-hardware-internet-data-server-communication-connection-datacenter.jpg\",alt:\"Network Equipment\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Having a good firewall in place when building a home network is something that now is more important than ever. Traditionally, home firewalls were made to \",(0,n.jsx)(e.strong,{children:\"protect\"}),\" the internal \",(0,n.jsx)(e.strong,{children:\"local network\"}),\" from connection that could originate from the internet (That's what you expect from an ISP provided modem/router combo). In this day and age, thanks to the \",(0,n.jsx)(e.strong,{children:\"fast rise\"}),\" of \",(0,n.jsx)(e.strong,{children:\"smart home\"}),\" gadgets, our home networks are becoming more and more occupied by little computers usually running firmware that is \",(0,n.jsx)(e.strong,{children:\"not possible to check\"}),\" or manage. A firewall can help us mitigate the \",(0,n.jsx)(e.a,{href:\"https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=upnp\",children:\"potential issues\"}),\" that can occur by using this kind of devices.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The intent of this article is to provide a \",(0,n.jsx)(e.strong,{children:\"sensible\"}),\" baseline \",(0,n.jsx)(e.strong,{children:\"configuration\"}),\" that you can expand to suit your own needs. These concepts can be applied on a variety of SOHO routers (check yor router for VLAN tagging support and firewall capabilities between different networks).\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The router I've chosen to use for this post is the small and mighty \",(0,n.jsx)(e.a,{href:\"https://amzn.to/2FtPBv9\",children:(0,n.jsx)(e.strong,{children:\"Ubiquiti EdgeRouter X\"})}),\", a five port router that's plenty capable of handling a medium-to-large home network without \",(0,n.jsx)(e.em,{children:\"breaking the bank\"}),\". This router runs a fork of Vyatta called \",(0,n.jsx)(e.strong,{children:\"EdgeOS\"}),` as the stock operating system.\nI've paired this device with a `,(0,n.jsx)(e.a,{href:\"https://amzn.to/2DXEkm6\",children:(0,n.jsx)(e.strong,{children:\"Unifi Access Point\"})}),\" to satisfy all my Wi-Fi needs.\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"High-level overview\"}),`\n`,(0,n.jsx)(e.p,{children:\"The steps you need to take care of are the following:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Create\"}),\" a new \",(0,n.jsx)(e.strong,{children:\"virtual interface\"}),\" and assing it an IP address;\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Attach\"}),\" the virtual interface to an ethernet port;\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Setup a firewall\"}),\" to isolate this new interface from the rest of your network.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{children:\"EdgeOS specific configuration\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"To configure the EdgeRouter we are going to use the CLI. We are going to \",(0,n.jsx)(e.strong,{children:\"start\"}),' a configuration session by typing \"configure\" into the shell.']}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Create\"}),\" a network group that targets \",(0,n.jsx)(e.a,{href:\"https://tools.ietf.org/html/rfc1918\",children:(0,n.jsx)(e.strong,{children:\"RFC1918\"})}),\" networks:\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set firewall group network-group RFC1918 description 'RFC1918 ranges'\nset firewall group network-group RFC1918 network 192.168.0.0/16\nset firewall group network-group RFC1918 network 172.16.0.0/12\nset firewall group network-group RFC1918 network 10.0.0.0/8\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"2\",children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Setup the firewall to \",(0,n.jsx)(e.strong,{children:\"block\"}),\" traffic to RFC1918 networks but allow DNS and DHCP:\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set firewall name IOT_IN_LOCAL default-action accept\nset firewall name IOT_IN_LOCAL description 'IOT In and Local ruleset.'\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"2.1 We are going to \",(0,n.jsx)(e.strong,{children:\"allow established and related\"}),\" network traffic so that we can access the IOT devices from other networks.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set firewall name IOT_IN_LOCAL rule 10 action accept\nset firewall name IOT_IN_LOCAL rule 10 description 'allow established/related'\nset firewall name IOT_IN_LOCAL rule 10 protocol all\nset firewall name IOT_IN_LOCAL rule 10 state established enable\nset firewall name IOT_IN_LOCAL rule 10 state related enable\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"2.2 We can't forget to allow \",(0,n.jsx)(e.strong,{children:\"DHCP\"}),` requests so that our devices can get an IP address.\nIt might be useful to allow `,(0,n.jsx)(e.strong,{children:\"DNS\"}),\" requests originating from our IOT VLAN too.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set firewall name IOT_IN_LOCAL rule 20 action accept\nset firewall name IOT_IN_LOCAL rule 20 description 'Allow DNS'\nset firewall name IOT_IN_LOCAL rule 20 destination port 53\nset firewall name IOT_IN_LOCAL rule 20 protocol tcp_udp\n\nset firewall name IOT_IN_LOCAL rule 30 action accept\nset firewall name IOT_IN_LOCAL rule 30 description 'Allow DHCP'\nset firewall name IOT_IN_LOCAL rule 30 destination port 67\nset firewall name IOT_IN_LOCAL rule 30 protocol udp\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"2.3 The last firewall rule we are going to setup is the one that \",(0,n.jsx)(e.strong,{children:\"blocks\"}),\" traffic going to our other private network(s).\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set firewall name IOT_IN_LOCAL rule 40 action drop\nset firewall name IOT_IN_LOCAL rule 40 description 'Drop RFC1918'\nset firewall name IOT_IN_LOCAL rule 40 destination group network-group RFC1918\nset firewall name IOT_IN_LOCAL rule 40 protocol all\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"3\",children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Create\"}),\" a new \",(0,n.jsx)(e.strong,{children:\"virtual interface\"}),\" for the VLAN intended to be used by our IOT devices:\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set interfaces ethernet eth1 vif 32 address 10.0.32.1/24\nset interfaces ethernet eth1 vif 32 description IOT_VLAN\nset interfaces ethernet eht1 vif 32 mtu 1500\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"4\",children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Assign\"}),\" the firewall ruleset to the \",(0,n.jsx)(e.em,{children:\"in\"}),\" and \",(0,n.jsx)(e.em,{children:\"local\"}),\" sides of the firewall.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set interfaces ethernet eth1 vif 32 firewall in name IOT_IN_LOCAL\nset interfaces ethernet eth1 vif 32 firewall local name IOT_IN_LOCAL\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"5\",children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Setup the \",(0,n.jsx)(e.strong,{children:\"DHCP\"}),\" server to listen to the requests coming from the new VLAN:\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set service dhcp-server shared-network-name IOT_VLAN authoritative disable\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 default-router 10.0.32.1\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 dns-server 10.0.32.1\nset service dhcp-server shared-network-name IOT_VLAN subnet 10.0.32.0/24 lease 86499\nset service dhcp-server shared-network-name IOT_VLAN start 10.0.32.10 stop 10.0.32.100\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"6\",children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Setup the \",(0,n.jsx)(e.strong,{children:\"DNS\"}),\" forwarder to listen on this virtual interface:\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set service dns forwarding listen-on eth1.32\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"7\",children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Configure the \",(0,n.jsx)(e.strong,{children:\"mDNS repeater\"}),\" to enable mDNS resolution from our other networks (useful for devices like the Chromecast).\"]}),`\n`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`set service mdns repeater interface eth1\nset service mdns repeater interface eth1.32\n`})}),`\n`,(0,n.jsxs)(e.ol,{start:\"8\",children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Save\"}),' your configuration with \"commit\" and then \"save\".']}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"At this point you should now have a new VLAN that cannot see your other networks but can still access the internet.\"}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"Disclosure: this post contains one (or more) affiliate link. If you buy something through one of those links you won't pay anything more but I'll get a small commission that helps me mantaining this blog.\"})})]})}function _(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(h,t)})):h(t)}var v=_;return O(N);})();\n;return Component;"
    },
    "_id": "blog/iot-vlan-edgeos.md",
    "_raw": {
      "sourceFilePath": "blog/iot-vlan-edgeos.md",
      "sourceFileName": "iot-vlan-edgeos.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/iot-vlan-edgeos"
    },
    "type": "Post",
    "url": "blog/iot-vlan-edgeos",
    "timeToRead": "4"
  },
  {
    "title": "iPadOS, a year-long review",
    "excerpt": "Looking at iPadOS from a content creation perspective",
    "date": "2020-10-31T00:00:00.000Z",
    "tags": [
      "Apple"
    ],
    "body": {
      "raw": "\nWhat's an iPad? Is it a real computer? You might ask. Well, long story short: you can look at it as a computer only if your **use-cases** match what Apple envisioned for it. Let’s take a deep dive into it.\n\n![A confused iPad](https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/confusedipad.svg)\n\niPadOS is a **fun computing platform** designed for a _touch-first_ interaction model, and let me get this straight: it excels at it.  \nIf you take a look at **competing platforms** like Windows, ChromeOS, or Android, you will see ecosystems that are **far from perfect** on tablets.  \nThese platforms are designed with input paradigms tied to a mouse and a keyboard or a smartphone interface.  \nThe iPad, on the other hand, is _distinctive_ and what sets it apart is the **App ecosystem**.  \nHowever, this shouldn't be an invitation to Apple to stop fixing things or adding new features to the iPad.\n\n## There's an app for that\n\nThe iPad platform offers a **clean slate** that developers are happy to use and develop for. The App Store is full of pretty **good iPad apps**.  \nThe quality of these apps is usually _top-notch_ and the often powerful chips on these devices help to deliver a smooth experience.\n\nLooking through an Android user's perspective, one of the most **fascinating** things is that the developer **adoption** of new frameworks or new hardware features is always **fast**. Developers are keen on updating their apps to take advantage of these new features.\nThere's always something _fresh_ on the iPad and each iPadOS update brings new features to the table.\n\n### Productivity & Creativity\n\nOne of the main reasons I bought an iPad is to run productivity apps.\nApple took a **great stance** with the introduction of the **Apple Pencil** and the Smart Keyboard(s). The iPad has become a productivity-first device and not another content consumption machine.\n\nApps like [**GoodNotes**](https://apps.apple.com/us/app/goodnotes-5/id1444383602), [**Pretext**](https://apps.apple.com/us/app/pretext/id1347707000), or [**Concepts**](https://apps.apple.com/us/app/concepts/id560586497) feel right at home on the iPad. Starting from iPadOS 13.4, the addition of first-class mouse support on the iPad brought exciting new possibilities to this platform.\n\n**Creativity-oriented** apps on the iPad are **powerful** yet simple. You will comfortably adapt from a keyboard and mouse workflow to the iPad since creating something on it requires less cognitive load.  \nI'm a big fan of apps like [**Procreate**](https://apps.apple.com/us/app/procreate/id425073498) (even though I can't draw). Keep in mind that developers are bringing more and more desktop apps to the iPad. On the App Store, you'll see names like Affinity Designer, Affinity Photo. There's even a slice of Adobe Creative Cloud apps on the iPad!\n\n## Input on the iPad\n\nI feel like this is an area of the iPad experience that can take a **little revision**. Input feels fluid, some of the interactions are well presented and understandable but there are times I find them very **confusing**.\n\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/4Pv3rEjI4fQ\" frameBorder={0} allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen></iframe>\n\nJust look at this video by Apple Support. It's just scratching the surface. Now add a trackpad, a keyboard, and the Apple Pencil. It's _gesture-ville_!  \nThere's even a _shake-to-undo_ gesture on by default and the best time to discover it is when you're trying to get something done inside a vehicle.\n\n![Undo typing popup](https://i.ibb.co/D4NKn5g/aintthatfun.png)\n_Oh, Hi! Hello there!_\n\n### Apple Pencil, a must that comes at a price\n\nThe Apple Pencil is one of the accessories that **separate** the iPad experience **from other tablets**. It's not an extension of your fingers. It's a **tool** designed for **content creation**.  \nWith iPadOS 14 and the introduction of **Scribble** and **handwriting editing**, you can use the Apple Pencil on a lot more apps.\n\n![The Apple Pencil](https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/applepencil.svg)\n\n> If you're using the iPad for anything more other than content consumption, the Pencil is a **must**.\n\nThe responsiveness of the Pencil is **remarkable**. It feels like you're writing on paper. There are only one problem and two annoyances:\n\n1. It **costs** 1/3 of the cheapest iPad;\n2. **Placement** and **charging** of the first generation is ridiculous (solved by the second generation);\n3. **Not every part** of the iPad interface **supports it** (more on this later).\n\n### Mouse and Keyboard\n\nThe default software keyboard is okay. It's the only keyboard I know that supports **split typing** on the iPad. It's **responsive** most of the time. The only problem I encountered with it is when using a combination of keyboard-based input and the new \"Scribble\" feature.\n\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/mqefxehXa_c\" frameBorder={0} allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen></iframe>\n\nWhen you add a physical keyboard and a mouse to the iPad equation, it starts **feeling like a real computer**. Text interaction is instantly **natural**. If you're coming from a macOS machine, the majority of the **shortcuts are the same**.\n\nThe mouse/trackpad experience on the iPad is **far from the desktop-like experience** and not in a bad way. The cursor is **optimized for touch-first interfaces** and morphs into the UI element you're trying to point and click and sticks to it, like a magnet.\n\n<iframe width=\"100%\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/ZP0zeUfYt7U\" frameBorder={0} allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowFullScreen></iframe>\n\n## Multitasking\n\niPadOS is a _focus-centric_ operating system. It has **interesting** multitasking abilities although, for me, they are meant to be used in a burst when a single app on screen can be limiting.\n\nI find myself using the \"Slideover\" feature a lot when I need to check on something quickly and not strictly related to the main task. Instead, I use the split-screen feature to reference notes and transfer data between apps.\n\nThe **discoverability** factor of the various multitasking features is pretty **low**. How am I supposed to know, at a glance, that there are multiple drop targets for the apps?\n\nA limitation that may seem small of the iPad multitasking is that it's only limited to apps you have in the **dock** or dragged from **Spotlight**. You will quickly realize that it's **not a small limitation** when you can't trigger Spotlight from other apps if you don't have a keyboard attached.\n\nSomething **funny** about the multitasking UI is that you **can't use** it with the **Apple Pencil**. Strange. I can drag files and apps just fine with the Pencil elsewhere in the system.\n\n## Settings\n\nI feel like settings on iPadOS are **flawed**. The idea of **centralizing** everything under one roof looks good even though it's not something every developer adapted their apps for. You'll find a lot of **inconsistencies** and settings **scattered** between the app and the Settings app.\n\n![Procreate inside Settings App](https://i.ibb.co/2cstJ5C/IMG-0617.png)\n\n![Settings inside Procreate](https://i.ibb.co/DYgJt3N/IMG-0616.png)\n<i className=\"text-center\">Procreate settings example</i>\n\nWhat are the **criteria** used to move a setting from one screen to another? **I will never know.**\n\n## Home Screen\n\nThe iPad home screen remained **simple** even with the advent of iPadOS 14. I'd love to see widgets on the home screen like the iOS counterpart.\nThe icon grid is well-spaced. Selecting the \"more\" option is something you should do immediately.\n\nI wish Apple gave us the ability to use the **App Library** on the iPad since the home screen can get messy when you have a lot of apps.\n\n## File Management\n\nFile management on the iPad happens inside the \"Files\" app. You can also see connected **external drives** in the Files app.  \nThe iPad doesn't expose its whole **filesystem** to apps. Inter-app communication can happen in two ways: [**FileProvider**](https://developer.apple.com/documentation/fileprovider) or the **share sheet.**\n\n![Pretext and iSH](https://i.ibb.co/NS2G5xS/IMG-0608.jpg)\n<i className=\"text-center\">Pretext and iSH working togheter via the FileProvider Framework.</i>\n\nApps using the FileProvider Framework can see other apps files and work with them. It's a little feature that can enable powerful workflows on the iPad.  \nFor example, you can connect your camera to your iPad and access pictures from Pixelmator Photo. Edit the images and then save them to Google Drive without switching any app.\n\n## Scriptable goodness\n\nAnother powerful app on the iPad is \"Shortcuts\".\n**Shortcuts** are like mini-applets that you can make to **automate** all sorts of things. You can use them to send commands to other machines via SSH or to consume a REST API.\n\nIf you're an automation geek you'll feel right at home with its interface.  \nI use Shortcuts to compress images, control my Torrent box, and shorten URLs.\n\n![An illustration of me with an iPad and a heart](https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/doilovemyipad.svg)\n\n## Honorable Mentions\n\n- **HomeKit** is the fastest way to control my smart home since it controls devices locally and it's not cloud-dependent.\n\n- **Spotlight** search is _really_ fast and apps integrate with it nicely.\n\n- The **App Store** \"Today\" view is well-curated and often brings up some hidden gems. App discoverability, in general, is stellar on the iPad.\n\n## Wish List\n\nI wish Apple took the developer market more seriously with the iPad. A built-in **UNIX shell** would make me very happy.  \nAnother wish would be better **conferencing** app support on the iPad since only FaceTime can use the popup view.\n\nOverall, the iPad is proving a **powerful** device to learn, create, and consume on. It's making me **curious** about iOS in general.\nThe iPad is a device that I'm more than happy using. I don't see it parting away from my digital life anytime soon.\n",
      "code": "var Component=(()=>{var c=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),y=(n,e)=>{for(var i in e)o(n,i,{get:e[i],enumerable:!0})},s=(n,e,i,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of g(e))!u.call(n,r)&&r!==i&&o(n,r,{get:()=>e[r],enumerable:!(a=p(e,r))||a.enumerable});return n};var w=(n,e,i)=>(i=n!=null?c(m(n)):{},s(e||!n||!n.__esModule?o(i,\"default\",{value:n,enumerable:!0}):i,n)),b=n=>s(o({},\"__esModule\",{value:!0}),n);var l=f((A,h)=>{h.exports=_jsx_runtime});var I={};y(I,{default:()=>k,frontmatter:()=>v});var t=w(l()),v={title:\"iPadOS, a year-long review\",date:\"2020-10-31\",excerpt:\"Looking at iPadOS from a content creation perspective\",tags:[\"Apple\"]};function d(n){let e=Object.assign({p:\"p\",strong:\"strong\",img:\"img\",em:\"em\",br:\"br\",h2:\"h2\",h3:\"h3\",a:\"a\",blockquote:\"blockquote\",ol:\"ol\",li:\"li\",ul:\"ul\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"What's an iPad? Is it a real computer? You might ask. Well, long story short: you can look at it as a computer only if your \",(0,t.jsx)(e.strong,{children:\"use-cases\"}),\" match what Apple envisioned for it. Let\\u2019s take a deep dive into it.\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/confusedipad.svg\",alt:\"A confused iPad\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"iPadOS is a \",(0,t.jsx)(e.strong,{children:\"fun computing platform\"}),\" designed for a \",(0,t.jsx)(e.em,{children:\"touch-first\"}),\" interaction model, and let me get this straight: it excels at it.\",(0,t.jsx)(e.br,{}),`\n`,\"If you take a look at \",(0,t.jsx)(e.strong,{children:\"competing platforms\"}),\" like Windows, ChromeOS, or Android, you will see ecosystems that are \",(0,t.jsx)(e.strong,{children:\"far from perfect\"}),\" on tablets.\",(0,t.jsx)(e.br,{}),`\n`,\"These platforms are designed with input paradigms tied to a mouse and a keyboard or a smartphone interface.\",(0,t.jsx)(e.br,{}),`\n`,\"The iPad, on the other hand, is \",(0,t.jsx)(e.em,{children:\"distinctive\"}),\" and what sets it apart is the \",(0,t.jsx)(e.strong,{children:\"App ecosystem\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"However, this shouldn't be an invitation to Apple to stop fixing things or adding new features to the iPad.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"There's an app for that\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"The iPad platform offers a \",(0,t.jsx)(e.strong,{children:\"clean slate\"}),\" that developers are happy to use and develop for. The App Store is full of pretty \",(0,t.jsx)(e.strong,{children:\"good iPad apps\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"The quality of these apps is usually \",(0,t.jsx)(e.em,{children:\"top-notch\"}),\" and the often powerful chips on these devices help to deliver a smooth experience.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Looking through an Android user's perspective, one of the most \",(0,t.jsx)(e.strong,{children:\"fascinating\"}),\" things is that the developer \",(0,t.jsx)(e.strong,{children:\"adoption\"}),\" of new frameworks or new hardware features is always \",(0,t.jsx)(e.strong,{children:\"fast\"}),`. Developers are keen on updating their apps to take advantage of these new features.\nThere's always something `,(0,t.jsx)(e.em,{children:\"fresh\"}),\" on the iPad and each iPadOS update brings new features to the table.\"]}),`\n`,(0,t.jsx)(e.h3,{children:\"Productivity & Creativity\"}),`\n`,(0,t.jsxs)(e.p,{children:[`One of the main reasons I bought an iPad is to run productivity apps.\nApple took a `,(0,t.jsx)(e.strong,{children:\"great stance\"}),\" with the introduction of the \",(0,t.jsx)(e.strong,{children:\"Apple Pencil\"}),\" and the Smart Keyboard(s). The iPad has become a productivity-first device and not another content consumption machine.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Apps like \",(0,t.jsx)(e.a,{href:\"https://apps.apple.com/us/app/goodnotes-5/id1444383602\",children:(0,t.jsx)(e.strong,{children:\"GoodNotes\"})}),\", \",(0,t.jsx)(e.a,{href:\"https://apps.apple.com/us/app/pretext/id1347707000\",children:(0,t.jsx)(e.strong,{children:\"Pretext\"})}),\", or \",(0,t.jsx)(e.a,{href:\"https://apps.apple.com/us/app/concepts/id560586497\",children:(0,t.jsx)(e.strong,{children:\"Concepts\"})}),\" feel right at home on the iPad. Starting from iPadOS 13.4, the addition of first-class mouse support on the iPad brought exciting new possibilities to this platform.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"Creativity-oriented\"}),\" apps on the iPad are \",(0,t.jsx)(e.strong,{children:\"powerful\"}),\" yet simple. You will comfortably adapt from a keyboard and mouse workflow to the iPad since creating something on it requires less cognitive load.\",(0,t.jsx)(e.br,{}),`\n`,\"I'm a big fan of apps like \",(0,t.jsx)(e.a,{href:\"https://apps.apple.com/us/app/procreate/id425073498\",children:(0,t.jsx)(e.strong,{children:\"Procreate\"})}),\" (even though I can't draw). Keep in mind that developers are bringing more and more desktop apps to the iPad. On the App Store, you'll see names like Affinity Designer, Affinity Photo. There's even a slice of Adobe Creative Cloud apps on the iPad!\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Input on the iPad\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"I feel like this is an area of the iPad experience that can take a \",(0,t.jsx)(e.strong,{children:\"little revision\"}),\". Input feels fluid, some of the interactions are well presented and understandable but there are times I find them very \",(0,t.jsx)(e.strong,{children:\"confusing\"}),\".\"]}),`\n`,(0,t.jsx)(\"iframe\",{width:\"100%\",height:\"315\",src:\"https://www.youtube-nocookie.com/embed/4Pv3rEjI4fQ\",frameBorder:0,allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowFullScreen:!0}),`\n`,(0,t.jsxs)(e.p,{children:[\"Just look at this video by Apple Support. It's just scratching the surface. Now add a trackpad, a keyboard, and the Apple Pencil. It's \",(0,t.jsx)(e.em,{children:\"gesture-ville\"}),\"!\",(0,t.jsx)(e.br,{}),`\n`,\"There's even a \",(0,t.jsx)(e.em,{children:\"shake-to-undo\"}),\" gesture on by default and the best time to discover it is when you're trying to get something done inside a vehicle.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.img,{src:\"https://i.ibb.co/D4NKn5g/aintthatfun.png\",alt:\"Undo typing popup\"}),`\n`,(0,t.jsx)(e.em,{children:\"Oh, Hi! Hello there!\"})]}),`\n`,(0,t.jsx)(e.h3,{children:\"Apple Pencil, a must that comes at a price\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"The Apple Pencil is one of the accessories that \",(0,t.jsx)(e.strong,{children:\"separate\"}),\" the iPad experience \",(0,t.jsx)(e.strong,{children:\"from other tablets\"}),\". It's not an extension of your fingers. It's a \",(0,t.jsx)(e.strong,{children:\"tool\"}),\" designed for \",(0,t.jsx)(e.strong,{children:\"content creation\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"With iPadOS 14 and the introduction of \",(0,t.jsx)(e.strong,{children:\"Scribble\"}),\" and \",(0,t.jsx)(e.strong,{children:\"handwriting editing\"}),\", you can use the Apple Pencil on a lot more apps.\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/applepencil.svg\",alt:\"The Apple Pencil\"})}),`\n`,(0,t.jsxs)(e.blockquote,{children:[`\n`,(0,t.jsxs)(e.p,{children:[\"If you're using the iPad for anything more other than content consumption, the Pencil is a \",(0,t.jsx)(e.strong,{children:\"must\"}),\".\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.p,{children:[\"The responsiveness of the Pencil is \",(0,t.jsx)(e.strong,{children:\"remarkable\"}),\". It feels like you're writing on paper. There are only one problem and two annoyances:\"]}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsxs)(e.li,{children:[\"It \",(0,t.jsx)(e.strong,{children:\"costs\"}),\" 1/3 of the cheapest iPad;\"]}),`\n`,(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:\"Placement\"}),\" and \",(0,t.jsx)(e.strong,{children:\"charging\"}),\" of the first generation is ridiculous (solved by the second generation);\"]}),`\n`,(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:\"Not every part\"}),\" of the iPad interface \",(0,t.jsx)(e.strong,{children:\"supports it\"}),\" (more on this later).\"]}),`\n`]}),`\n`,(0,t.jsx)(e.h3,{children:\"Mouse and Keyboard\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"The default software keyboard is okay. It's the only keyboard I know that supports \",(0,t.jsx)(e.strong,{children:\"split typing\"}),\" on the iPad. It's \",(0,t.jsx)(e.strong,{children:\"responsive\"}),' most of the time. The only problem I encountered with it is when using a combination of keyboard-based input and the new \"Scribble\" feature.']}),`\n`,(0,t.jsx)(\"iframe\",{width:\"100%\",height:\"315\",src:\"https://www.youtube-nocookie.com/embed/mqefxehXa_c\",frameBorder:0,allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowFullScreen:!0}),`\n`,(0,t.jsxs)(e.p,{children:[\"When you add a physical keyboard and a mouse to the iPad equation, it starts \",(0,t.jsx)(e.strong,{children:\"feeling like a real computer\"}),\". Text interaction is instantly \",(0,t.jsx)(e.strong,{children:\"natural\"}),\". If you're coming from a macOS machine, the majority of the \",(0,t.jsx)(e.strong,{children:\"shortcuts are the same\"}),\".\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"The mouse/trackpad experience on the iPad is \",(0,t.jsx)(e.strong,{children:\"far from the desktop-like experience\"}),\" and not in a bad way. The cursor is \",(0,t.jsx)(e.strong,{children:\"optimized for touch-first interfaces\"}),\" and morphs into the UI element you're trying to point and click and sticks to it, like a magnet.\"]}),`\n`,(0,t.jsx)(\"iframe\",{width:\"100%\",height:\"315\",src:\"https://www.youtube-nocookie.com/embed/ZP0zeUfYt7U\",frameBorder:0,allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowFullScreen:!0}),`\n`,(0,t.jsx)(e.h2,{children:\"Multitasking\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"iPadOS is a \",(0,t.jsx)(e.em,{children:\"focus-centric\"}),\" operating system. It has \",(0,t.jsx)(e.strong,{children:\"interesting\"}),\" multitasking abilities although, for me, they are meant to be used in a burst when a single app on screen can be limiting.\"]}),`\n`,(0,t.jsx)(e.p,{children:'I find myself using the \"Slideover\" feature a lot when I need to check on something quickly and not strictly related to the main task. Instead, I use the split-screen feature to reference notes and transfer data between apps.'}),`\n`,(0,t.jsxs)(e.p,{children:[\"The \",(0,t.jsx)(e.strong,{children:\"discoverability\"}),\" factor of the various multitasking features is pretty \",(0,t.jsx)(e.strong,{children:\"low\"}),\". How am I supposed to know, at a glance, that there are multiple drop targets for the apps?\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"A limitation that may seem small of the iPad multitasking is that it's only limited to apps you have in the \",(0,t.jsx)(e.strong,{children:\"dock\"}),\" or dragged from \",(0,t.jsx)(e.strong,{children:\"Spotlight\"}),\". You will quickly realize that it's \",(0,t.jsx)(e.strong,{children:\"not a small limitation\"}),\" when you can't trigger Spotlight from other apps if you don't have a keyboard attached.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Something \",(0,t.jsx)(e.strong,{children:\"funny\"}),\" about the multitasking UI is that you \",(0,t.jsx)(e.strong,{children:\"can't use\"}),\" it with the \",(0,t.jsx)(e.strong,{children:\"Apple Pencil\"}),\". Strange. I can drag files and apps just fine with the Pencil elsewhere in the system.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Settings\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"I feel like settings on iPadOS are \",(0,t.jsx)(e.strong,{children:\"flawed\"}),\". The idea of \",(0,t.jsx)(e.strong,{children:\"centralizing\"}),\" everything under one roof looks good even though it's not something every developer adapted their apps for. You'll find a lot of \",(0,t.jsx)(e.strong,{children:\"inconsistencies\"}),\" and settings \",(0,t.jsx)(e.strong,{children:\"scattered\"}),\" between the app and the Settings app.\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://i.ibb.co/2cstJ5C/IMG-0617.png\",alt:\"Procreate inside Settings App\"})}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.img,{src:\"https://i.ibb.co/DYgJt3N/IMG-0616.png\",alt:\"Settings inside Procreate\"}),`\n`,(0,t.jsx)(\"i\",{className:\"text-center\",children:\"Procreate settings example\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"What are the \",(0,t.jsx)(e.strong,{children:\"criteria\"}),\" used to move a setting from one screen to another? \",(0,t.jsx)(e.strong,{children:\"I will never know.\"})]}),`\n`,(0,t.jsx)(e.h2,{children:\"Home Screen\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"The iPad home screen remained \",(0,t.jsx)(e.strong,{children:\"simple\"}),` even with the advent of iPadOS 14. I'd love to see widgets on the home screen like the iOS counterpart.\nThe icon grid is well-spaced. Selecting the \"more\" option is something you should do immediately.`]}),`\n`,(0,t.jsxs)(e.p,{children:[\"I wish Apple gave us the ability to use the \",(0,t.jsx)(e.strong,{children:\"App Library\"}),\" on the iPad since the home screen can get messy when you have a lot of apps.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"File Management\"}),`\n`,(0,t.jsxs)(e.p,{children:['File management on the iPad happens inside the \"Files\" app. You can also see connected ',(0,t.jsx)(e.strong,{children:\"external drives\"}),\" in the Files app.\",(0,t.jsx)(e.br,{}),`\n`,\"The iPad doesn't expose its whole \",(0,t.jsx)(e.strong,{children:\"filesystem\"}),\" to apps. Inter-app communication can happen in two ways: \",(0,t.jsx)(e.a,{href:\"https://developer.apple.com/documentation/fileprovider\",children:(0,t.jsx)(e.strong,{children:\"FileProvider\"})}),\" or the \",(0,t.jsx)(e.strong,{children:\"share sheet.\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.img,{src:\"https://i.ibb.co/NS2G5xS/IMG-0608.jpg\",alt:\"Pretext and iSH\"}),`\n`,(0,t.jsx)(\"i\",{className:\"text-center\",children:\"Pretext and iSH working togheter via the FileProvider Framework.\"})]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Apps using the FileProvider Framework can see other apps files and work with them. It's a little feature that can enable powerful workflows on the iPad.\",(0,t.jsx)(e.br,{}),`\n`,\"For example, you can connect your camera to your iPad and access pictures from Pixelmator Photo. Edit the images and then save them to Google Drive without switching any app.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Scriptable goodness\"}),`\n`,(0,t.jsxs)(e.p,{children:[`Another powerful app on the iPad is \"Shortcuts\".\n`,(0,t.jsx)(e.strong,{children:\"Shortcuts\"}),\" are like mini-applets that you can make to \",(0,t.jsx)(e.strong,{children:\"automate\"}),\" all sorts of things. You can use them to send commands to other machines via SSH or to consume a REST API.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"If you're an automation geek you'll feel right at home with its interface.\",(0,t.jsx)(e.br,{}),`\n`,\"I use Shortcuts to compress images, control my Torrent box, and shorten URLs.\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://raw.githubusercontent.com/eliseomartelli/illustrations/main/svg/doilovemyipad.svg\",alt:\"An illustration of me with an iPad and a heart\"})}),`\n`,(0,t.jsx)(e.h2,{children:\"Honorable Mentions\"}),`\n`,(0,t.jsxs)(e.ul,{children:[`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"HomeKit\"}),\" is the fastest way to control my smart home since it controls devices locally and it's not cloud-dependent.\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"Spotlight\"}),\" search is \",(0,t.jsx)(e.em,{children:\"really\"}),\" fast and apps integrate with it nicely.\"]}),`\n`]}),`\n`,(0,t.jsxs)(e.li,{children:[`\n`,(0,t.jsxs)(e.p,{children:[\"The \",(0,t.jsx)(e.strong,{children:\"App Store\"}),' \"Today\" view is well-curated and often brings up some hidden gems. App discoverability, in general, is stellar on the iPad.']}),`\n`]}),`\n`]}),`\n`,(0,t.jsx)(e.h2,{children:\"Wish List\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"I wish Apple took the developer market more seriously with the iPad. A built-in \",(0,t.jsx)(e.strong,{children:\"UNIX shell\"}),\" would make me very happy.\",(0,t.jsx)(e.br,{}),`\n`,\"Another wish would be better \",(0,t.jsx)(e.strong,{children:\"conferencing\"}),\" app support on the iPad since only FaceTime can use the popup view.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Overall, the iPad is proving a \",(0,t.jsx)(e.strong,{children:\"powerful\"}),\" device to learn, create, and consume on. It's making me \",(0,t.jsx)(e.strong,{children:\"curious\"}),` about iOS in general.\nThe iPad is a device that I'm more than happy using. I don't see it parting away from my digital life anytime soon.`]})]})}function P(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(d,n)})):d(n)}var k=P;return b(I);})();\n;return Component;"
    },
    "_id": "blog/ipados_review.md",
    "_raw": {
      "sourceFilePath": "blog/ipados_review.md",
      "sourceFileName": "ipados_review.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/ipados_review"
    },
    "type": "Post",
    "url": "blog/ipados_review",
    "timeToRead": "7"
  },
  {
    "title": "Configuring Nebula, a simple overlay networking tool",
    "excerpt": "Overlay networking that scaaaaaaaaaales",
    "date": "2020-05-01T00:00:00.000Z",
    "tags": [
      "Network"
    ],
    "body": {
      "raw": "\n![](https://cdn.spacetelescope.org/archives/images/screen/opo9544b.jpg)\n\nVPNs are one of the preferred ways to tie-up multiple servers (and clients) together, but their nature becomes a **bottleneck** when the infrastructure to _link_ becomes larger.\\\nA solution to this problem comes in the form of a software defined network **(SDN)**.\n\n**[Nebula](https://github.com/slackhq/nebula)** (from SlackHQ) addresses this problem by providing software that helps you build a point-to-point network between devices that can be situated (almost) anywhere in the world!\n\nThe communication between devices is encrypted using the [Noise Protocol Framework](https://noiseprotocol.org/), the same used by Signal.\n\nAnd you know what's great? Nebula is completely **open source!**\n\n## Nebula Vocabolary\n\nNebula's vocabolary is not so different from normal networking, you should only get accostumed to two terms:\n\n- lighthouse;\n- node.\n\n**Lighthouse** is the term used by Nebula to address **nodes** that are publicly routable.\\\nA node connects first to the **lighthouse**, then it discovers the most efficent path to reach other nodes on the network.\n\n## Configuring Nebula\n\nLet's get to the fun part!\n\nAs stated earlier, to run a Nebula Lighthouse you need a machine with a **publicly routable** IP address, if you don't have one, a little 5\\$ Droplet on [DigitalOcean](https://m.do.co/c/33e2f0a1e231) will do just fine.\\\nThis guide will show you how to run Nebula **as a regular user**, in constrast with the official documentation that assumes you will run Nebula as the root user.\n\nOn the machines you'd like to attach to Nebula, you need to **download the binary** from the release page on GitHub and then extract it using _tar_.\n\n```bash\n$ curl -OL https://github.com/slackhq/nebula/releases/download/v1.2.0/nebula-linux-amd64.tar.gz\n$ tar xzvf nebula-linux-amd64.tar.gz\n```\n\nNow you need to **move the Nebula binary** to /usr/bin/ and set the right permissions.\\\nYou can do it manually or you can use the _[install](https://man.cx/install)_ command.\n\n```bash\n# install ./nebula /usr/bin\n```\n\nSince we don't want to run Nebula as root, it's the right time to add a _system_ user (so it's **hidden** from your login manager) for Nebula.\\\nThis new user doesn't need a _home_ directory, so we're instructing the _useradd_ command to not create one.\n\n```bash\n# useradd --system --no-create-home nebula\n```\n\nFollowing the [Filesystem Hierarchy Standard](https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard) that states that configuration files should reside in the /etc directory, we're going to **create the directories** to store configuration files and certificates that are related to Nebula.\n\n```bash\n# mkdir /etc/nebula\n# mkdir /etc/nebula/certs\n```\n\nTo instantiate a Nebula network you have to **generate a Nebula Certificate authority**, preferably on another host so you can keep your private key secure. Remember to copy the certificate to your hosts!\n\n```bash\n$ ./nebula-cert ca -name \"My really cool organization\"\n$ scp ca.crt user@<hostname>:/etc/nebula/certs\n```\n\nMake sure to **keep the ca.key file in a safe place**, you will need it if you want to add other hosts to your network.\n\n**Generate a keypair** for each host you'd like to connect to your Nebula network and copy the pair to your Nebula's hosts:\n\n```bash\n$ ./nebula-cert sign -name \"mylighthouse\" -ip \"192.168.100.1/24\"\n$ scp mylighthouse.crt user@<hostname>:/etc/nebula/certs\n$ scp mylighthouse.key user@<hostname>:/etc/nebula/certs\n```\n\nIt's time to configure Nebula!\\\n**Create a configuration file** inside the previously created directory and open it with your text editor of choice. I've deviced to put my configuration in /etc/nebula/config.yml.\nThe configuration will look a bit different depending by the node, for example, my Lighthouse node is sporting this configuration:\n\n```yaml\npki:\n  ca: /etc/nebula/certs/ca.crt\n  cert: /etc/nebula/certs/mylighthouse.crt\n  key: /etc/nebula/certs/mylighthouse.key\n\nlighthouse:\n  am_lighthouse: true\n\nlisten:\n  host: 0.0.0.0\n  port: 4242\n\npunchy:\n  punch: true\n\ntun:\n  dev: nebula1\n  drop_local_broadcast: false\n  drop_multicast: false\n  tx_queue: 500\n  mtu: 1300\n  routes:\n  unsafe_routes:\n\nfirewall:\n  conntrack:\n    tcp_timeout: 120h\n    udp_timeout: 3m\n    default_timeout: 10m\n    max_connections: 100000\n\n  outbound:\n    # Allow all outbound traffic from this node\n    - port: any\n      proto: any\n      host: any\n\n  inbound:\n    # Allow icmp between any nebula hosts\n    - port: any\n      proto: icmp\n      host: any\n```\n\nOn my other nodes, the configuration looks something like this:\n\n```yaml\npki:\n  ca: /etc/nebula/certs/ca.crt\n  cert: /etc/nebula/certs/mynode.crt\n  key: /etc/nebula/certs/mynode.key\n\nstatic_host_map:\n  \"192.168.100.1\": [\"<lighthouse_public_ip>:4242\"]\n\nlighthouse:\n  hosts:\n    - \"192.168.100.1\"\n\npunchy:\n  punch: true\n\ntun:\n  dev: nebula1\n  drop_local_broadcast: false\n  drop_multicast: false\n  tx_queue: 500\n  mtu: 1300\n  routes:\n  unsafe_routes:\n\nfirewall:\n  conntrack:\n    tcp_timeout: 120h\n    udp_timeout: 3m\n    default_timeout: 10m\n    max_connections: 100000\n\n  outbound:\n    # Allow all outbound traffic from this node\n    - port: any\n      proto: any\n      host: any\n\n  inbound:\n    # Allow icmp between any nebula hosts\n    - port: any\n      proto: icmp\n      host: any\n```\n\nNote that **nodes** need to **define their \"Lighthouse\".**\n\nTo make our \"nebula\" user the owner of the /etc/nebula directory, we have to change the ownership of it. We should also change the permissions of the certificats to something less permissive.\n\n```bash\n# chown -R nebula:nebula /etc/nebula\n# chmod 600 /etc/nebula/certs/*\n```\n\nWe're almost done! The second-last thing to do is to add the _NET_CAP_ADMIN_ capability to the Nebula binary since it needs to be able to create a new interface on the system.\n\n```bash\n# setcap cap_net_admin=+pe /usr/bin/nebula\n```\n\nFor our last step, we run Nebula as the nebula user on our hosts.\n\n```bash\n# su nebula\n$ nebula -config /etc/nebula/config.yml\n```\n\nTo **test Nebula** open a new shell and try to ping another machine on the Nebula network, _it's almost magical_.\n\n## Nebula as a Systemd unit\n\nA natural step to take after you've tested Nebula is to **run it as a service** so you don't need to start it manually each time you need it. Well, nothing could be simpler!\\\nYou just have to create and edit a Systemd unit. An example can be found below:\n\n_/etc/systemd/system/nebula.service_\n\n```\n[Unit]\nDescription=Nebula Service\nAfter=network.target\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=1\nUser=nebula\nExecStart=/usr/bin/nebula -config /etc/nebula/config.yml\n\n[Install]\nWantedBy=multi-user.target\n```\n\nNote that this Systemd unit runs Nebula with the \"nebula\" user and starts just after reaching the network target.\n\nNow you need to **reload** configuration files for the daemons on your system so Systemd can pick-up the new unit:\n\n```bash\n# systemctl daemon-reload\n```\n\nYou can now **enable** the Nebula service so it starts automatically after a reboot. If you're not going to reboot, remember to **start** the service manually. 😉\n\n```bash\n# systemctl enable nebula.service\n# systemctl start nebula.service\n```\n\n---\n\n#### Update: Launchd on macOS\n\nIf you want to run Nebula as a daemon on **macOS**, create and edit a launchd plist file as follows:\n\n_/Library/LaunchDaemons/com.nebula.plist_\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n  <dict>\n      <key>Label</key>\n      <string>/usr/local/bin/nebula</string>\n      <key>LaunchOnlyOnce</key>\n      <true/>\n      <key>ProgramArguments</key>\n      <array>\n          <string>/usr/local/bin/nebula</string>\n          <string>-config</string>\n          <string>/etc/nebula/config.yml</string>\n      </array>\n      <key>RunAtLoad</key>\n      <true/>\n  </dict>\n</plist>\n```\n\nRemember to load this new daemon:\n\n```bash\n# sudo launchctl load /Library/LaunchDaemons/com.nebula.plist\n```\n\nOh, nice to see you here!  \nIf you've reached the end of this post you can now enjoy your _freshly baked_ SDN!\n\n---\n\n_Disclosure: this post contains one (or more) affiliate link. If you buy something through one of those links you won't pay anything more but I'll get a small commission that helps me mantaining this blog._\n",
      "code": "var Component=(()=>{var u=Object.create;var o=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),y=(t,e)=>{for(var r in e)o(t,r,{get:e[r],enumerable:!0})},l=(t,e,r,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of m(e))!g.call(t,a)&&a!==r&&o(t,a,{get:()=>e[a],enumerable:!(i=d(e,a))||i.enumerable});return t};var f=(t,e,r)=>(r=t!=null?u(p(t)):{},l(e||!t||!t.__esModule?o(r,\"default\",{value:t,enumerable:!0}):r,t)),w=t=>l(o({},\"__esModule\",{value:!0}),t);var c=b((S,s)=>{s.exports=_jsx_runtime});var _={};y(_,{default:()=>v,frontmatter:()=>k});var n=f(c()),k={title:\"Configuring Nebula, a simple overlay networking tool\",date:\"2020-05-01\",excerpt:\"Overlay networking that scaaaaaaaaaales\",tags:[\"Network\"]};function h(t){let e=Object.assign({p:\"p\",img:\"img\",strong:\"strong\",em:\"em\",br:\"br\",a:\"a\",h2:\"h2\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",hr:\"hr\",h4:\"h4\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"https://cdn.spacetelescope.org/archives/images/screen/opo9544b.jpg\",alt:\"\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"VPNs are one of the preferred ways to tie-up multiple servers (and clients) together, but their nature becomes a \",(0,n.jsx)(e.strong,{children:\"bottleneck\"}),\" when the infrastructure to \",(0,n.jsx)(e.em,{children:\"link\"}),\" becomes larger.\",(0,n.jsx)(e.br,{}),`\n`,\"A solution to this problem comes in the form of a software defined network \",(0,n.jsx)(e.strong,{children:\"(SDN)\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://github.com/slackhq/nebula\",children:\"Nebula\"})}),\" (from SlackHQ) addresses this problem by providing software that helps you build a point-to-point network between devices that can be situated (almost) anywhere in the world!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The communication between devices is encrypted using the \",(0,n.jsx)(e.a,{href:\"https://noiseprotocol.org/\",children:\"Noise Protocol Framework\"}),\", the same used by Signal.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"And you know what's great? Nebula is completely \",(0,n.jsx)(e.strong,{children:\"open source!\"})]}),`\n`,(0,n.jsx)(e.h2,{children:\"Nebula Vocabolary\"}),`\n`,(0,n.jsx)(e.p,{children:\"Nebula's vocabolary is not so different from normal networking, you should only get accostumed to two terms:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"lighthouse;\"}),`\n`,(0,n.jsx)(e.li,{children:\"node.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Lighthouse\"}),\" is the term used by Nebula to address \",(0,n.jsx)(e.strong,{children:\"nodes\"}),\" that are publicly routable.\",(0,n.jsx)(e.br,{}),`\n`,\"A node connects first to the \",(0,n.jsx)(e.strong,{children:\"lighthouse\"}),\", then it discovers the most efficent path to reach other nodes on the network.\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Configuring Nebula\"}),`\n`,(0,n.jsx)(e.p,{children:\"Let's get to the fun part!\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"As stated earlier, to run a Nebula Lighthouse you need a machine with a \",(0,n.jsx)(e.strong,{children:\"publicly routable\"}),\" IP address, if you don't have one, a little 5$ Droplet on \",(0,n.jsx)(e.a,{href:\"https://m.do.co/c/33e2f0a1e231\",children:\"DigitalOcean\"}),\" will do just fine.\",(0,n.jsx)(e.br,{}),`\n`,\"This guide will show you how to run Nebula \",(0,n.jsx)(e.strong,{children:\"as a regular user\"}),\", in constrast with the official documentation that assumes you will run Nebula as the root user.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"On the machines you'd like to attach to Nebula, you need to \",(0,n.jsx)(e.strong,{children:\"download the binary\"}),\" from the release page on GitHub and then extract it using \",(0,n.jsx)(e.em,{children:\"tar\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`$ curl -OL https://github.com/slackhq/nebula/releases/download/v1.2.0/nebula-linux-amd64.tar.gz\n$ tar xzvf nebula-linux-amd64.tar.gz\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now you need to \",(0,n.jsx)(e.strong,{children:\"move the Nebula binary\"}),\" to /usr/bin/ and set the right permissions.\",(0,n.jsx)(e.br,{}),`\n`,\"You can do it manually or you can use the \",(0,n.jsx)(e.em,{children:(0,n.jsx)(e.a,{href:\"https://man.cx/install\",children:\"install\"})}),\" command.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# install ./nebula /usr/bin\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Since we don't want to run Nebula as root, it's the right time to add a \",(0,n.jsx)(e.em,{children:\"system\"}),\" user (so it's \",(0,n.jsx)(e.strong,{children:\"hidden\"}),\" from your login manager) for Nebula.\",(0,n.jsx)(e.br,{}),`\n`,\"This new user doesn't need a \",(0,n.jsx)(e.em,{children:\"home\"}),\" directory, so we're instructing the \",(0,n.jsx)(e.em,{children:\"useradd\"}),\" command to not create one.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`#\\xA0useradd --system --no-create-home nebula\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Following the \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard\",children:\"Filesystem Hierarchy Standard\"}),\" that states that configuration files should reside in the /etc directory, we're going to \",(0,n.jsx)(e.strong,{children:\"create the directories\"}),\" to store configuration files and certificates that are related to Nebula.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# mkdir /etc/nebula\n# mkdir /etc/nebula/certs\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To instantiate a Nebula network you have to \",(0,n.jsx)(e.strong,{children:\"generate a Nebula Certificate authority\"}),\", preferably on another host so you can keep your private key secure. Remember to copy the certificate to your hosts!\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`$ ./nebula-cert ca -name \"My really cool organization\"\n$ scp ca.crt user@<hostname>:/etc/nebula/certs\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Make sure to \",(0,n.jsx)(e.strong,{children:\"keep the ca.key file in a safe place\"}),\", you will need it if you want to add other hosts to your network.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Generate a keypair\"}),\" for each host you'd like to connect to your Nebula network and copy the pair to your Nebula's hosts:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`$ ./nebula-cert sign -name \"mylighthouse\" -ip \"192.168.100.1/24\"\n$ scp mylighthouse.crt user@<hostname>:/etc/nebula/certs\n$ scp mylighthouse.key user@<hostname>:/etc/nebula/certs\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's time to configure Nebula!\",(0,n.jsx)(e.br,{}),`\n`,(0,n.jsx)(e.strong,{children:\"Create a configuration file\"}),` inside the previously created directory and open it with your text editor of choice. I've deviced to put my configuration in /etc/nebula/config.yml.\nThe configuration will look a bit different depending by the node, for example, my Lighthouse node is sporting this configuration:`]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`pki:\n  ca: /etc/nebula/certs/ca.crt\n  cert: /etc/nebula/certs/mylighthouse.crt\n  key: /etc/nebula/certs/mylighthouse.key\n\nlighthouse:\n  am_lighthouse: true\n\nlisten:\n  host: 0.0.0.0\n  port: 4242\n\npunchy:\n  punch: true\n\ntun:\n  dev: nebula1\n  drop_local_broadcast: false\n  drop_multicast: false\n  tx_queue: 500\n  mtu: 1300\n  routes:\n  unsafe_routes:\n\nfirewall:\n  conntrack:\n    tcp_timeout: 120h\n    udp_timeout: 3m\n    default_timeout: 10m\n    max_connections: 100000\n\n  outbound:\n    # Allow all outbound traffic from this node\n    - port: any\n      proto: any\n      host: any\n\n  inbound:\n    # Allow icmp between any nebula hosts\n    - port: any\n      proto: icmp\n      host: any\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"On my other nodes, the configuration looks something like this:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-yaml\",children:`pki:\n  ca: /etc/nebula/certs/ca.crt\n  cert: /etc/nebula/certs/mynode.crt\n  key: /etc/nebula/certs/mynode.key\n\nstatic_host_map:\n  \"192.168.100.1\": [\"<lighthouse_public_ip>:4242\"]\n\nlighthouse:\n  hosts:\n    - \"192.168.100.1\"\n\npunchy:\n  punch: true\n\ntun:\n  dev: nebula1\n  drop_local_broadcast: false\n  drop_multicast: false\n  tx_queue: 500\n  mtu: 1300\n  routes:\n  unsafe_routes:\n\nfirewall:\n  conntrack:\n    tcp_timeout: 120h\n    udp_timeout: 3m\n    default_timeout: 10m\n    max_connections: 100000\n\n  outbound:\n    # Allow all outbound traffic from this node\n    - port: any\n      proto: any\n      host: any\n\n  inbound:\n    # Allow icmp between any nebula hosts\n    - port: any\n      proto: icmp\n      host: any\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Note that \",(0,n.jsx)(e.strong,{children:\"nodes\"}),\" need to \",(0,n.jsx)(e.strong,{children:'define their \"Lighthouse\".'})]}),`\n`,(0,n.jsx)(e.p,{children:'To make our \"nebula\" user the owner of the /etc/nebula directory, we have to change the ownership of it. We should also change the permissions of the certificats to something less permissive.'}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# chown -R nebula:nebula /etc/nebula\n# chmod 600 /etc/nebula/certs/*\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We're almost done! The second-last thing to do is to add the \",(0,n.jsx)(e.em,{children:\"NET_CAP_ADMIN\"}),\" capability to the Nebula binary since it needs to be able to create a new interface on the system.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# setcap cap_net_admin=+pe /usr/bin/nebula\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"For our last step, we run Nebula as the nebula user on our hosts.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# su nebula\n$ nebula -config /etc/nebula/config.yml\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To \",(0,n.jsx)(e.strong,{children:\"test Nebula\"}),\" open a new shell and try to ping another machine on the Nebula network, \",(0,n.jsx)(e.em,{children:\"it's almost magical\"}),\".\"]}),`\n`,(0,n.jsx)(e.h2,{children:\"Nebula as a Systemd unit\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"A natural step to take after you've tested Nebula is to \",(0,n.jsx)(e.strong,{children:\"run it as a service\"}),\" so you don't need to start it manually each time you need it. Well, nothing could be simpler!\",(0,n.jsx)(e.br,{}),`\n`,\"You just have to create and edit a Systemd unit. An example can be found below:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"/etc/systemd/system/nebula.service\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`[Unit]\nDescription=Nebula Service\nAfter=network.target\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=1\nUser=nebula\nExecStart=/usr/bin/nebula -config /etc/nebula/config.yml\n\n[Install]\nWantedBy=multi-user.target\n`})}),`\n`,(0,n.jsx)(e.p,{children:'Note that this Systemd unit runs Nebula with the \"nebula\" user and starts just after reaching the network target.'}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now you need to \",(0,n.jsx)(e.strong,{children:\"reload\"}),\" configuration files for the daemons on your system so Systemd can pick-up the new unit:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# systemctl daemon-reload\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can now \",(0,n.jsx)(e.strong,{children:\"enable\"}),\" the Nebula service so it starts automatically after a reboot. If you're not going to reboot, remember to \",(0,n.jsx)(e.strong,{children:\"start\"}),\" the service manually. \\u{1F609}\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`#\\xA0systemctl enable nebula.service\n#\\xA0systemctl start nebula.service\n`})}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.h4,{children:\"Update: Launchd on macOS\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you want to run Nebula as a daemon on \",(0,n.jsx)(e.strong,{children:\"macOS\"}),\", create and edit a launchd plist file as follows:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"/Library/LaunchDaemons/com.nebula.plist\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-xml\",children:`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n  <dict>\n      <key>Label</key>\n      <string>/usr/local/bin/nebula</string>\n      <key>LaunchOnlyOnce</key>\n      <true/>\n      <key>ProgramArguments</key>\n      <array>\n          <string>/usr/local/bin/nebula</string>\n          <string>-config</string>\n          <string>/etc/nebula/config.yml</string>\n      </array>\n      <key>RunAtLoad</key>\n      <true/>\n  </dict>\n</plist>\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"Remember to load this new daemon:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-bash\",children:`# sudo launchctl load /Library/LaunchDaemons/com.nebula.plist\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Oh, nice to see you here!\",(0,n.jsx)(e.br,{}),`\n`,\"If you've reached the end of this post you can now enjoy your \",(0,n.jsx)(e.em,{children:\"freshly baked\"}),\" SDN!\"]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"Disclosure: this post contains one (or more) affiliate link. If you buy something through one of those links you won't pay anything more but I'll get a small commission that helps me mantaining this blog.\"})})]})}function N(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(h,t)})):h(t)}var v=N;return w(_);})();\n;return Component;"
    },
    "_id": "blog/nebula.md",
    "_raw": {
      "sourceFilePath": "blog/nebula.md",
      "sourceFileName": "nebula.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/nebula"
    },
    "type": "Post",
    "url": "blog/nebula",
    "timeToRead": "6"
  },
  {
    "title": "Netflix Payments reminder with the help of Home Assistant",
    "excerpt": "Aren't you tired of being the only one to pay for Netflix?",
    "date": "2020-03-02T00:00:00.000Z",
    "tags": [
      "Misc"
    ],
    "body": {
      "raw": "\nToday's project aims at tracking the _invoices_ of a shared account thanks to [Home Assistant](https://home-assistant.io).  \nFor those of you that don't know what Home Assistant is, well, Home Assistant is a versatile home automation software that can integrate a lot of different devices. It's starting to become an essential part of my living areas thanks to its possibilities.  \nAnd sometimes you _just_ wish that you could use it to automate people (just kiddin').\n\n## Prerequisites\n\nIf you're reading this, it's probably too late and you've already got your feet wet with Home Assistant. Otherwise, you need an installation of Home Assistant. You can install it following the official documentation [here](https://www.home-assistant.io/getting-started/).  \nYou also need a Telegram bot, you can create one using Telegram's [@botfather](https://telegram.me/BotFather).\n\n## Counting in Home Assistant\n\nHome Assistant has a built-in way of counting _things_: the [counter](https://www.home-assistant.io/integrations/counter/) integration.  \nThis integration offers a way of storing an integer number and changing its value.  \nWe're going to setup this integration in our configuration.yaml file (situated in the root of our Home Assistant configuration folder).\n\n```yaml\ncounter:\n  netflix_user_0:\n    initial: 0\n    step: 4\n    name: Mario\n  netflix_user_1:\n    initial: 0\n    step: 4\n    name: Luigi\n  netflix_user_2:\n    initial: 0\n    step: 4\n    name: Wario\n```\n\n## Scheduling counter's increments\n\nIn a _nutshell_, Home Assistant makes things happen through automations.\nAutomations are *pieces of code* that will run when something triggers it and/or some conditions are met.  \nIn a home automation system, they are the glue that can tie all of our devices together.  \nToday we’ll use them to create a recurring task dedicated to incrementing our newly added counters.\n\n```yaml\nautomation:\n  - alias: Increment Counter\n    trigger:\n      - platform: time\n        at: \"10:00:00\"\n    condition:\n      - condition: template\n        value_template: \"{{ now().day == 25 }}\"\n    action:\n      - service: counter.increment\n        entity_id:\n          - counter.netflix_user_0\n          - counter.netflix_user_1\n          - counter.netflix_user_2\n```\n\nAs for the above example, our automation will be composed by three distinct parts:\n\n1. A trigger;\n2. A condition;\n3. An action.\n\nThis automation will **check** every day at 10:00 am if the current day is the 25th of the month, if the **condition** is **true**, it will execute the **action** of incrementing the counters with the predefined step.\n\n## Notify the people in the sharing group\n\nAn important part of this project is **notifying** your friends if there's a change on their \"debts\".\nThis part is tied to the messaging service of your choice.  \nI consider myself lucky that our \"sharing group\" is on Telegram, widely supported by the official Home Assistant [integration](https://www.home-assistant.io/integrations/telegram/).\n\nSo, you might have guessed it, we're using **Telegram** today.\n\nTo configure this integration you have to put the following inside your configuration.yaml:\n\n```yaml\ntelegram_bot:\n  - platform: polling\n    api_key: YOUR_API_KEY\n    allowed_chat_ids:\n      - YOUR_CHAT_ID\n      - GROUP_CHAT_ID\n\nnotify:\n  - name: NOTIFIER_NAME\n    platform: telegram\n    chat_id: GROUP_CHAT_ID\n```\n\n_You can get chat ids using [@chatid_echo_bot](https://t.me/chatid_echo_bot)._\n\n## Sending messages to a Telegram group\n\nAfter the setup of the Telegram platform we need to find a way to send notifications to our group.  \nLet's assume we decide to send a message to our group every time we increment the counters.  \nTo do so we just need to **edit** our previous automation and add the following **action**:\n\n```yaml\n- service: notify.netflix_group\n  data_template:\n    message: >\n      ⚠️ Status:  \n\n      {{ states.counter.netflix_user_0.name }}: € {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: € {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: € {{ states.counter.netflix_user_2.state }}\n```\n\nWe're using **templates** so we can **dynamically** generate the message.\n\nReached this point, we can _call it a day_ and the basics of our system are now working. But at the moment we have no way to track _\"automatically\"_ if a user paid its _debt_.\n\n## User input from Telegram inline keyboard\n\nOne of the options given by Telegram to interact with bots is the **inline keyboard**.  \nInline keyboards are a set of buttons _attached_ to a message sent by a bot.  \nEach button _triggers_ a callback (to which Home Assistant can respond).\n\n### Adding an inline keyboard to a message\n\n![Screenshot of a Telegram chat showing the inline keyboard](https://i.ibb.co/xHLSbbQ/Screenshot-20200302-001437-01.jpg)\n\nAdding an inline keyboard to a message is a _trivial_ operation, we just need to define our keyboard in our message.  \nIt can be done by editing the previous action by adding:\n\n```yaml\ndata:\n  inline_keyboard:\n    - \"User0:/dec0\"\n    - \"User1:/dec1\"\n    - \"User2:/dec2\"\n```\n\nThe **resulting action** will look something like that:\n\n```yaml\n- service: notify.netflix_group\n  data_template:\n    message: >\n      ⚠️ Status:  \n\n      {{ states.counter.netflix_user_0.name }}: € {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: € {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: € {{ states.counter.netflix_user_2.state }}\n    data:\n      inline_keyboard:\n        - \"User0:/dec0\"\n        - \"User1:/dec1\"\n        - \"User2:/dec2\"\n```\n\n### Reacting to Telegram callbacks\n\n**We're almost there!** We have counters, buttons, automations and messages.  \nNow we should let our friends notify our system with the buttons mentioned above.  \nWe have to **react** to their callbacks: according to the [official documentation](https://www.home-assistant.io/integrations/telegram_bot#sample-automations-with-callback-queries-and-inline-keyboards), we need another automation to react to the callbacks.\n\nOur automation is gonna look like this one:\n\n```yaml\nalias: Other Netflix Decrement Counter\ntrigger:\n  - platform: event\n    event_type: telegram_callback\n    event_data:\n      chat_id: GROUP_CHAT_ID\ncondition:\n  - condition: template\n    value_template: >\n      {{ \"/dec\" in trigger.event.data.command }}\naction:\n  - service: counter.decrement\n    data_template:\n      entity_id: >\n        counter.netflix_user_{{ trigger.event.data.command | replace(\"/dec\", \"\") }}\n```\n\nThe **condition** is there to **check** if the command that we received contains the string: \"/dec\".  \nIn the action we see another **template**, this one is used to get the right counter based on the button that got pressed.\n\n### Updating the message\n\nA possible solution to notify of the decrement is to send another message, but I'm not using this solution because it appears quite _\"chatty\"_ to me and I don't want to annoy my friends.  \nSince Telegram supports **editing of messages**, I've opted to use this solution.\nWe just need to add another action to the previous automation.\n\n```yaml\n- service: telegram_bot.edit_message\n  data_template:\n    message_id: \"{{ trigger.event.data.message.message_id }}\"\n    chat_id: \"{{ trigger.event.data.chat_id }}\"\n    title: \"*Message edit*\"\n    message: >\n      ⚠️ Status:  \n\n      {{ states.counter.netflix_user_0.name }}: € {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: € {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: € {{ states.counter.netflix_user_2.state }}\n    inline_keyboard:\n      - \"User0:/dec0\"\n      - \"User1:/dec1\"\n      - \"User2:/dec2\"\n```\n\n## Final Steps\n\nWe're ready to deploy!  \nAdd your _new, and fresh baked_ Telegram bot to your sharing group.  \nYour friends will be grateful for this simple and effective reminder 😇.\n",
      "code": "var Component=(()=>{var h=Object.create;var r=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),_=(n,e)=>{for(var i in e)r(n,i,{get:e[i],enumerable:!0})},s=(n,e,i,o)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of m(e))!p.call(n,a)&&a!==i&&r(n,a,{get:()=>e[a],enumerable:!(o=u(e,a))||o.enumerable});return n};var y=(n,e,i)=>(i=n!=null?h(g(n)):{},s(e||!n||!n.__esModule?r(i,\"default\",{value:n,enumerable:!0}):i,n)),b=n=>s(r({},\"__esModule\",{value:!0}),n);var c=f((T,l)=>{l.exports=_jsx_runtime});var k={};_(k,{default:()=>v,frontmatter:()=>w});var t=y(c()),w={title:\"Netflix Payments reminder with the help of Home Assistant\",date:\"2020-03-02\",excerpt:\"Aren't you tired of being the only one to pay for Netflix?\",tags:[\"Misc\"]};function d(n){let e=Object.assign({p:\"p\",em:\"em\",a:\"a\",br:\"br\",h2:\"h2\",pre:\"pre\",code:\"code\",ol:\"ol\",li:\"li\",strong:\"strong\",h3:\"h3\",img:\"img\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"Today's project aims at tracking the \",(0,t.jsx)(e.em,{children:\"invoices\"}),\" of a shared account thanks to \",(0,t.jsx)(e.a,{href:\"https://home-assistant.io\",children:\"Home Assistant\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"For those of you that don't know what Home Assistant is, well, Home Assistant is a versatile home automation software that can integrate a lot of different devices. It's starting to become an essential part of my living areas thanks to its possibilities.\",(0,t.jsx)(e.br,{}),`\n`,\"And sometimes you \",(0,t.jsx)(e.em,{children:\"just\"}),\" wish that you could use it to automate people (just kiddin').\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Prerequisites\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"If you're reading this, it's probably too late and you've already got your feet wet with Home Assistant. Otherwise, you need an installation of Home Assistant. You can install it following the official documentation \",(0,t.jsx)(e.a,{href:\"https://www.home-assistant.io/getting-started/\",children:\"here\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"You also need a Telegram bot, you can create one using Telegram's \",(0,t.jsx)(e.a,{href:\"https://telegram.me/BotFather\",children:\"@botfather\"}),\".\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Counting in Home Assistant\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"Home Assistant has a built-in way of counting \",(0,t.jsx)(e.em,{children:\"things\"}),\": the \",(0,t.jsx)(e.a,{href:\"https://www.home-assistant.io/integrations/counter/\",children:\"counter\"}),\" integration.\",(0,t.jsx)(e.br,{}),`\n`,\"This integration offers a way of storing an integer number and changing its value.\",(0,t.jsx)(e.br,{}),`\n`,\"We're going to setup this integration in our configuration.yaml file (situated in the root of our Home Assistant configuration folder).\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`counter:\n  netflix_user_0:\n    initial: 0\n    step: 4\n    name: Mario\n  netflix_user_1:\n    initial: 0\n    step: 4\n    name: Luigi\n  netflix_user_2:\n    initial: 0\n    step: 4\n    name: Wario\n`})}),`\n`,(0,t.jsx)(e.h2,{children:\"Scheduling counter's increments\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"In a \",(0,t.jsx)(e.em,{children:\"nutshell\"}),`, Home Assistant makes things happen through automations.\nAutomations are\\xA0`,(0,t.jsx)(e.em,{children:\"pieces of code\"}),\"\\xA0that will run when something triggers it and/or some conditions are met.\",(0,t.jsx)(e.br,{}),`\n`,\"In a home automation system, they are the glue that can tie all of our devices together.\",(0,t.jsx)(e.br,{}),`\n`,\"Today we\\u2019ll use them to create a recurring task dedicated to incrementing our newly added counters.\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`automation:\n  - alias: Increment Counter\n    trigger:\n      - platform: time\n        at: \"10:00:00\"\n    condition:\n      - condition: template\n        value_template: \"{{ now().day == 25 }}\"\n    action:\n      - service: counter.increment\n        entity_id:\n          - counter.netflix_user_0\n          - counter.netflix_user_1\n          - counter.netflix_user_2\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"As for the above example, our automation will be composed by three distinct parts:\"}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsx)(e.li,{children:\"A trigger;\"}),`\n`,(0,t.jsx)(e.li,{children:\"A condition;\"}),`\n`,(0,t.jsx)(e.li,{children:\"An action.\"}),`\n`]}),`\n`,(0,t.jsxs)(e.p,{children:[\"This automation will \",(0,t.jsx)(e.strong,{children:\"check\"}),\" every day at 10:00 am if the current day is the 25th of the month, if the \",(0,t.jsx)(e.strong,{children:\"condition\"}),\" is \",(0,t.jsx)(e.strong,{children:\"true\"}),\", it will execute the \",(0,t.jsx)(e.strong,{children:\"action\"}),\" of incrementing the counters with the predefined step.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Notify the people in the sharing group\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"An important part of this project is \",(0,t.jsx)(e.strong,{children:\"notifying\"}),` your friends if there's a change on their \"debts\".\nThis part is tied to the messaging service of your choice.`,(0,t.jsx)(e.br,{}),`\n`,'I consider myself lucky that our \"sharing group\" is on Telegram, widely supported by the official Home Assistant ',(0,t.jsx)(e.a,{href:\"https://www.home-assistant.io/integrations/telegram/\",children:\"integration\"}),\".\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"So, you might have guessed it, we're using \",(0,t.jsx)(e.strong,{children:\"Telegram\"}),\" today.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"To configure this integration you have to put the following inside your configuration.yaml:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`telegram_bot:\n  - platform: polling\n    api_key: YOUR_API_KEY\n    allowed_chat_ids:\n      - YOUR_CHAT_ID\n      - GROUP_CHAT_ID\n\nnotify:\n  - name: NOTIFIER_NAME\n    platform: telegram\n    chat_id: GROUP_CHAT_ID\n`})}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsxs)(e.em,{children:[\"You can get chat ids using \",(0,t.jsx)(e.a,{href:\"https://t.me/chatid_echo_bot\",children:\"@chatid_echo_bot\"}),\".\"]})}),`\n`,(0,t.jsx)(e.h2,{children:\"Sending messages to a Telegram group\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"After the setup of the Telegram platform we need to find a way to send notifications to our group.\",(0,t.jsx)(e.br,{}),`\n`,\"Let's assume we decide to send a message to our group every time we increment the counters.\",(0,t.jsx)(e.br,{}),`\n`,\"To do so we just need to \",(0,t.jsx)(e.strong,{children:\"edit\"}),\" our previous automation and add the following \",(0,t.jsx)(e.strong,{children:\"action\"}),\":\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`- service: notify.netflix_group\n  data_template:\n    message: >\n      \\u26A0\\uFE0F Status:  \n\n      {{ states.counter.netflix_user_0.name }}: \\u20AC {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: \\u20AC {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: \\u20AC {{ states.counter.netflix_user_2.state }}\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're using \",(0,t.jsx)(e.strong,{children:\"templates\"}),\" so we can \",(0,t.jsx)(e.strong,{children:\"dynamically\"}),\" generate the message.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Reached this point, we can \",(0,t.jsx)(e.em,{children:\"call it a day\"}),\" and the basics of our system are now working. But at the moment we have no way to track \",(0,t.jsx)(e.em,{children:'\"automatically\"'}),\" if a user paid its \",(0,t.jsx)(e.em,{children:\"debt\"}),\".\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"User input from Telegram inline keyboard\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"One of the options given by Telegram to interact with bots is the \",(0,t.jsx)(e.strong,{children:\"inline keyboard\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"Inline keyboards are a set of buttons \",(0,t.jsx)(e.em,{children:\"attached\"}),\" to a message sent by a bot.\",(0,t.jsx)(e.br,{}),`\n`,\"Each button \",(0,t.jsx)(e.em,{children:\"triggers\"}),\" a callback (to which Home Assistant can respond).\"]}),`\n`,(0,t.jsx)(e.h3,{children:\"Adding an inline keyboard to a message\"}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"https://i.ibb.co/xHLSbbQ/Screenshot-20200302-001437-01.jpg\",alt:\"Screenshot of a Telegram chat showing the inline keyboard\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Adding an inline keyboard to a message is a \",(0,t.jsx)(e.em,{children:\"trivial\"}),\" operation, we just need to define our keyboard in our message.\",(0,t.jsx)(e.br,{}),`\n`,\"It can be done by editing the previous action by adding:\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`data:\n  inline_keyboard:\n    - \"User0:/dec0\"\n    - \"User1:/dec1\"\n    - \"User2:/dec2\"\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The \",(0,t.jsx)(e.strong,{children:\"resulting action\"}),\" will look something like that:\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`- service: notify.netflix_group\n  data_template:\n    message: >\n      \\u26A0\\uFE0F Status:  \n\n      {{ states.counter.netflix_user_0.name }}: \\u20AC {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: \\u20AC {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: \\u20AC {{ states.counter.netflix_user_2.state }}\n    data:\n      inline_keyboard:\n        - \"User0:/dec0\"\n        - \"User1:/dec1\"\n        - \"User2:/dec2\"\n`})}),`\n`,(0,t.jsx)(e.h3,{children:\"Reacting to Telegram callbacks\"}),`\n`,(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:\"We're almost there!\"}),\" We have counters, buttons, automations and messages.\",(0,t.jsx)(e.br,{}),`\n`,\"Now we should let our friends notify our system with the buttons mentioned above.\",(0,t.jsx)(e.br,{}),`\n`,\"We have to \",(0,t.jsx)(e.strong,{children:\"react\"}),\" to their callbacks: according to the \",(0,t.jsx)(e.a,{href:\"https://www.home-assistant.io/integrations/telegram_bot#sample-automations-with-callback-queries-and-inline-keyboards\",children:\"official documentation\"}),\", we need another automation to react to the callbacks.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"Our automation is gonna look like this one:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`alias: Other Netflix Decrement Counter\ntrigger:\n  - platform: event\n    event_type: telegram_callback\n    event_data:\n      chat_id: GROUP_CHAT_ID\ncondition:\n  - condition: template\n    value_template: >\n      {{ \"/dec\" in trigger.event.data.command }}\naction:\n  - service: counter.decrement\n    data_template:\n      entity_id: >\n        counter.netflix_user_{{ trigger.event.data.command | replace(\"/dec\", \"\") }}\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The \",(0,t.jsx)(e.strong,{children:\"condition\"}),\" is there to \",(0,t.jsx)(e.strong,{children:\"check\"}),' if the command that we received contains the string: \"/dec\".',(0,t.jsx)(e.br,{}),`\n`,\"In the action we see another \",(0,t.jsx)(e.strong,{children:\"template\"}),\", this one is used to get the right counter based on the button that got pressed.\"]}),`\n`,(0,t.jsx)(e.h3,{children:\"Updating the message\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"A possible solution to notify of the decrement is to send another message, but I'm not using this solution because it appears quite \",(0,t.jsx)(e.em,{children:'\"chatty\"'}),\" to me and I don't want to annoy my friends.\",(0,t.jsx)(e.br,{}),`\n`,\"Since Telegram supports \",(0,t.jsx)(e.strong,{children:\"editing of messages\"}),`, I've opted to use this solution.\nWe just need to add another action to the previous automation.`]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-yaml\",children:`- service: telegram_bot.edit_message\n  data_template:\n    message_id: \"{{ trigger.event.data.message.message_id }}\"\n    chat_id: \"{{ trigger.event.data.chat_id }}\"\n    title: \"*Message edit*\"\n    message: >\n      \\u26A0\\uFE0F Status:  \n\n      {{ states.counter.netflix_user_0.name }}: \\u20AC {{ states.counter.netflix_user_0.state }}  \n\n      {{ states.counter.netflix_user_1.name }}: \\u20AC {{ states.counter.netflix_user_1.state }}  \n\n      {{ states.counter.netflix_user_2.name }}: \\u20AC {{ states.counter.netflix_user_2.state }}\n    inline_keyboard:\n      - \"User0:/dec0\"\n      - \"User1:/dec1\"\n      - \"User2:/dec2\"\n`})}),`\n`,(0,t.jsx)(e.h2,{children:\"Final Steps\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're ready to deploy!\",(0,t.jsx)(e.br,{}),`\n`,\"Add your \",(0,t.jsx)(e.em,{children:\"new, and fresh baked\"}),\" Telegram bot to your sharing group.\",(0,t.jsx)(e.br,{}),`\n`,\"Your friends will be grateful for this simple and effective reminder \\u{1F607}.\"]})]})}function x(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(d,n)})):d(n)}var v=x;return b(k);})();\n;return Component;"
    },
    "_id": "blog/netflix-payments-home-assistant.md",
    "_raw": {
      "sourceFilePath": "blog/netflix-payments-home-assistant.md",
      "sourceFileName": "netflix-payments-home-assistant.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/netflix-payments-home-assistant"
    },
    "type": "Post",
    "url": "blog/netflix-payments-home-assistant",
    "timeToRead": "7"
  },
  {
    "title": "How to use pfSense to load balance between two ISPs",
    "excerpt": "Internet goes brrrrr with multiple WANs",
    "date": "2020-04-05T00:00:00.000Z",
    "tags": [
      "Network"
    ],
    "body": {
      "raw": "\nToday's post aims at helping people that are working/studying from home and don't have a stable internet conection.  \nSince me and my family are currently _staying at home_ we are **taxing our ADSL2+** connection very hard with multiple simultaneous video conferences, so I had to find a way to keep all my family online.  \nThe way I've chosen to do that is using **multiple WANs**, one of them being over **LTE**.\n\n<a href=\"https://ibb.co/DWQNfqz\"><img src=\"https://i.ibb.co/LR1MdGY/Untitled-Artwork.png\" alt=\"Untitled-Artwork\" border=\"0\"/></a>\n\n## Prerequisites\n\n1. A pfSense box with **3+ network interfaces**;\n2. A WAN and a LAN interface already configured inside pfSense;\n3. A **4G/LTE modem** that connects over ethernet.\n\nIf you already have the prerequisites sorted out, let's get to balancing!\n\n## Configure the additional interface\n\nTo start the _journey_ in load balancing, we'll start by telling our pfSense box where to find the interface that we will later use to connect our LTE router.\n\n<a href=\"https://ibb.co/5TcLbHh\"><img src=\"https://i.ibb.co/tBCDVrp/Screenshot-2020-04-05-at-21-36-07.png\" alt=\"Screenshot-2020-04-05-at-21-36-07\" border=\"0\"/></a>\n\nTo add an interface you need to open the **Assingnment** menu under **Interfaces**, select the desidered interface in the dropdown menu, and then click **add**.\n\n<a href=\"https://ibb.co/rt33d3Z\"><img src=\"https://i.ibb.co/wL77c7K/Screenshot-2020-04-05-at-21-36-51.png\" alt=\"Screenshot-2020-04-05-at-21-36-51\" border=\"0\"/></a>\n\nWe can now **configure** the chosen interface and assing it a name. In my case I had to setup the address of this interface with DHCP.\n\nNow it's a right time to **plug** our 4G/LTE modem to our pfSense box.\n\nAt the bottom of the page I checked block private and bogus networks, then you can hit **save** and reload the configuration.\n\n## Setup a multi-gateway\n\nWe're almost there!  \nWe have to **create a multi-gateway** that we'll later use to route our traffic through.\n\n<a href=\"https://ibb.co/0VXCMSH\"><img src=\"https://i.ibb.co/yBR6y1H/Screenshot-2020-04-05-at-21-38-53.png\" alt=\"Screenshot-2020-04-05-at-21-38-53\" border=\"0\"/></a>\n\nWe need to set a network tier, remember that a **lower** number is **preferred**.  \nIf both interfaces share the same network tier, pfSense will balance packets on both of them.  \nRemember to change the \"Trigger Level\" to \"Packet Loss or High Latency\" so you will always use the best connection.\n\n### Configure the firewall to use the multi-gateway\n\nThat's our **last step**!\nThe last thing to do is to configure our LAN firewall to **route** connections to our new _gateway group_.  \nWe need to open the **Rules** page of our firewall, select our **LAN** interface.\n\nOur rule will be a **\"Pass\"** rule that will be configured as following:\n\n```\nInterface: Lan\nProtocol: Any\nSource: Any\nDestination: Any\n```\n\n<a href=\"https://ibb.co/fdqV7kv\"><img src=\"https://i.ibb.co/4RKwx8d/Screenshot-2020-04-05-at-21-40-58.png\" alt=\"Screenshot-2020-04-05-at-21-40-58\" border=\"0\"/></a>\n\nThe last thing to do is going to the **advanced** section of our firewall rule and set the **gateway** to the previously created gateway group.\n\n<a href=\"https://ibb.co/Jy7SPvd\"><img src=\"https://i.ibb.co/Hxz9Qt2/Screenshot-2020-04-05-at-21-41-14.png\" alt=\"Screenshot-2020-04-05-at-21-41-14\" border=\"0\"/></a>\n\nWe're finally done!  \nYou can now go and test your load balanced network!\n",
      "code": "var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),m=(n,e)=>{for(var r in e)i(n,r,{get:e[r],enumerable:!0})},c=(n,e,r,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let o of u(e))!b.call(n,o)&&o!==r&&i(n,o,{get:()=>e[o],enumerable:!(a=g(e,o))||a.enumerable});return n};var w=(n,e,r)=>(r=n!=null?d(p(n)):{},c(e||!n||!n.__esModule?i(r,\"default\",{value:n,enumerable:!0}):r,n)),y=n=>c(i({},\"__esModule\",{value:!0}),n);var s=f((v,h)=>{h.exports=_jsx_runtime});var x={};m(x,{default:()=>k,frontmatter:()=>S});var t=w(s()),S={title:\"How to use pfSense to load balance between two ISPs\",date:\"2020-04-05\",excerpt:\"Internet goes brrrrr with multiple WANs\",tags:[\"Network\"]};function l(n){let e=Object.assign({p:\"p\",br:\"br\",em:\"em\",strong:\"strong\",h2:\"h2\",ol:\"ol\",li:\"li\",h3:\"h3\",pre:\"pre\",code:\"code\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"Today's post aims at helping people that are working/studying from home and don't have a stable internet conection.\",(0,t.jsx)(e.br,{}),`\n`,\"Since me and my family are currently \",(0,t.jsx)(e.em,{children:\"staying at home\"}),\" we are \",(0,t.jsx)(e.strong,{children:\"taxing our ADSL2+\"}),\" connection very hard with multiple simultaneous video conferences, so I had to find a way to keep all my family online.\",(0,t.jsx)(e.br,{}),`\n`,\"The way I've chosen to do that is using \",(0,t.jsx)(e.strong,{children:\"multiple WANs\"}),\", one of them being over \",(0,t.jsx)(e.strong,{children:\"LTE\"}),\".\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/DWQNfqz\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/LR1MdGY/Untitled-Artwork.png\",alt:\"Untitled-Artwork\",border:\"0\"})}),`\n`,(0,t.jsx)(e.h2,{children:\"Prerequisites\"}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsxs)(e.li,{children:[\"A pfSense box with \",(0,t.jsx)(e.strong,{children:\"3+ network interfaces\"}),\";\"]}),`\n`,(0,t.jsx)(e.li,{children:\"A WAN and a LAN interface already configured inside pfSense;\"}),`\n`,(0,t.jsxs)(e.li,{children:[\"A \",(0,t.jsx)(e.strong,{children:\"4G/LTE modem\"}),\" that connects over ethernet.\"]}),`\n`]}),`\n`,(0,t.jsx)(e.p,{children:\"If you already have the prerequisites sorted out, let's get to balancing!\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Configure the additional interface\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"To start the \",(0,t.jsx)(e.em,{children:\"journey\"}),\" in load balancing, we'll start by telling our pfSense box where to find the interface that we will later use to connect our LTE router.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/5TcLbHh\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/tBCDVrp/Screenshot-2020-04-05-at-21-36-07.png\",alt:\"Screenshot-2020-04-05-at-21-36-07\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"To add an interface you need to open the \",(0,t.jsx)(e.strong,{children:\"Assingnment\"}),\" menu under \",(0,t.jsx)(e.strong,{children:\"Interfaces\"}),\", select the desidered interface in the dropdown menu, and then click \",(0,t.jsx)(e.strong,{children:\"add\"}),\".\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/rt33d3Z\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/wL77c7K/Screenshot-2020-04-05-at-21-36-51.png\",alt:\"Screenshot-2020-04-05-at-21-36-51\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We can now \",(0,t.jsx)(e.strong,{children:\"configure\"}),\" the chosen interface and assing it a name. In my case I had to setup the address of this interface with DHCP.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Now it's a right time to \",(0,t.jsx)(e.strong,{children:\"plug\"}),\" our 4G/LTE modem to our pfSense box.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"At the bottom of the page I checked block private and bogus networks, then you can hit \",(0,t.jsx)(e.strong,{children:\"save\"}),\" and reload the configuration.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Setup a multi-gateway\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're almost there!\",(0,t.jsx)(e.br,{}),`\n`,\"We have to \",(0,t.jsx)(e.strong,{children:\"create a multi-gateway\"}),\" that we'll later use to route our traffic through.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/0VXCMSH\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/yBR6y1H/Screenshot-2020-04-05-at-21-38-53.png\",alt:\"Screenshot-2020-04-05-at-21-38-53\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We need to set a network tier, remember that a \",(0,t.jsx)(e.strong,{children:\"lower\"}),\" number is \",(0,t.jsx)(e.strong,{children:\"preferred\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"If both interfaces share the same network tier, pfSense will balance packets on both of them.\",(0,t.jsx)(e.br,{}),`\n`,'Remember to change the \"Trigger Level\" to \"Packet Loss or High Latency\" so you will always use the best connection.']}),`\n`,(0,t.jsx)(e.h3,{children:\"Configure the firewall to use the multi-gateway\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"That's our \",(0,t.jsx)(e.strong,{children:\"last step\"}),`!\nThe last thing to do is to configure our LAN firewall to `,(0,t.jsx)(e.strong,{children:\"route\"}),\" connections to our new \",(0,t.jsx)(e.em,{children:\"gateway group\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"We need to open the \",(0,t.jsx)(e.strong,{children:\"Rules\"}),\" page of our firewall, select our \",(0,t.jsx)(e.strong,{children:\"LAN\"}),\" interface.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Our rule will be a \",(0,t.jsx)(e.strong,{children:'\"Pass\"'}),\" rule that will be configured as following:\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`Interface: Lan\nProtocol: Any\nSource: Any\nDestination: Any\n`})}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/fdqV7kv\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/4RKwx8d/Screenshot-2020-04-05-at-21-40-58.png\",alt:\"Screenshot-2020-04-05-at-21-40-58\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The last thing to do is going to the \",(0,t.jsx)(e.strong,{children:\"advanced\"}),\" section of our firewall rule and set the \",(0,t.jsx)(e.strong,{children:\"gateway\"}),\" to the previously created gateway group.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/Jy7SPvd\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/Hxz9Qt2/Screenshot-2020-04-05-at-21-41-14.png\",alt:\"Screenshot-2020-04-05-at-21-41-14\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're finally done!\",(0,t.jsx)(e.br,{}),`\n`,\"You can now go and test your load balanced network!\"]})]})}function A(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(l,n)})):l(n)}var k=A;return y(x);})();\n;return Component;"
    },
    "_id": "blog/pfSense_multiple_wan.md",
    "_raw": {
      "sourceFilePath": "blog/pfSense_multiple_wan.md",
      "sourceFileName": "pfSense_multiple_wan.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/pfSense_multiple_wan"
    },
    "type": "Post",
    "url": "blog/pfSense_multiple_wan",
    "timeToRead": "2"
  },
  {
    "title": "Quick Tip: macOS as a cache for Apple Devices",
    "excerpt": "Papa Tim is surely happy if you have all those Apple devices",
    "date": "2020-04-09T00:00:00.000Z",
    "tags": [
      "Apple"
    ],
    "body": {
      "raw": "\nA cache server is a great tool to **speed up** recurring network requests (example: system updates) and reduce the overall used internet bandwidth.\n\nToday we'll see how to set-up a cache server for our Apple devices.\n\nLet's say that you have multiple Apple devices on your network and you happen to have a macOS device **always powered on** (or a macOS vm, ed.), you can use the after-mentioned device as a cache for your other devices.\n\nTo **check** if it's possible to use your Mac as a caching server, run this command:\n\n```bash\n$ AssetCacheManagerUtil canActivate\n```\n\nIf you get a \"**yes**\" as a response, you can set-up your cache server via this simple command:\n\n```bash\n$ sudo AssetCacheManagerUtil activate\n```\n\nYour devices will now discover this cache server automatically after a **reboot**.\n\nYou can find more information about this macOS feature [here](https://support.apple.com/guide/mac-help/manage-content-caching-command-line-mac-mchla6d4541e/mac).\n",
      "code": "var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var v=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),y=(n,e)=>{for(var t in e)c(n,t,{get:e[t],enumerable:!0})},o=(n,e,t,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of u(e))!g.call(n,r)&&r!==t&&c(n,r,{get:()=>e[r],enumerable:!(s=p(e,r))||s.enumerable});return n};var f=(n,e,t)=>(t=n!=null?h(m(n)):{},o(e||!n||!n.__esModule?c(t,\"default\",{value:n,enumerable:!0}):t,n)),x=n=>o(c({},\"__esModule\",{value:!0}),n);var l=v((M,i)=>{i.exports=_jsx_runtime});var j={};y(j,{default:()=>b,frontmatter:()=>w});var a=f(l()),w={title:\"Quick Tip: macOS as a cache for Apple Devices\",date:\"2020-04-09\",excerpt:\"Papa Tim is surely happy if you have all those Apple devices\",tags:[\"Apple\"]};function d(n){let e=Object.assign({p:\"p\",strong:\"strong\",pre:\"pre\",code:\"code\",a:\"a\"},n.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.p,{children:[\"A cache server is a great tool to \",(0,a.jsx)(e.strong,{children:\"speed up\"}),\" recurring network requests (example: system updates) and reduce the overall used internet bandwidth.\"]}),`\n`,(0,a.jsx)(e.p,{children:\"Today we'll see how to set-up a cache server for our Apple devices.\"}),`\n`,(0,a.jsxs)(e.p,{children:[\"Let's say that you have multiple Apple devices on your network and you happen to have a macOS device \",(0,a.jsx)(e.strong,{children:\"always powered on\"}),\" (or a macOS vm, ed.), you can use the after-mentioned device as a cache for your other devices.\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"To \",(0,a.jsx)(e.strong,{children:\"check\"}),\" if it's possible to use your Mac as a caching server, run this command:\"]}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-bash\",children:`$ AssetCacheManagerUtil canActivate\n`})}),`\n`,(0,a.jsxs)(e.p,{children:['If you get a \"',(0,a.jsx)(e.strong,{children:\"yes\"}),'\" as a response, you can set-up your cache server via this simple command:']}),`\n`,(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:\"language-bash\",children:`$ sudo AssetCacheManagerUtil activate\n`})}),`\n`,(0,a.jsxs)(e.p,{children:[\"Your devices will now discover this cache server automatically after a \",(0,a.jsx)(e.strong,{children:\"reboot\"}),\".\"]}),`\n`,(0,a.jsxs)(e.p,{children:[\"You can find more information about this macOS feature \",(0,a.jsx)(e.a,{href:\"https://support.apple.com/guide/mac-help/manage-content-caching-command-line-mac-mchla6d4541e/mac\",children:\"here\"}),\".\"]})]})}function A(n={}){let{wrapper:e}=n.components||{};return e?(0,a.jsx)(e,Object.assign({},n,{children:(0,a.jsx)(d,n)})):d(n)}var b=A;return x(j);})();\n;return Component;"
    },
    "_id": "blog/quick-tip-macos-as-a-cache-for-apple-devices.md",
    "_raw": {
      "sourceFilePath": "blog/quick-tip-macos-as-a-cache-for-apple-devices.md",
      "sourceFileName": "quick-tip-macos-as-a-cache-for-apple-devices.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/quick-tip-macos-as-a-cache-for-apple-devices"
    },
    "type": "Post",
    "url": "blog/quick-tip-macos-as-a-cache-for-apple-devices",
    "timeToRead": "1"
  },
  {
    "title": "OSPF over Wireguard with VyOS",
    "excerpt": "Avoiding static routes because I'm lazy and I wanted to lab a bit",
    "date": "2022-09-29T00:00:00.000Z",
    "tags": [
      "Network"
    ],
    "body": {
      "raw": "\nMy home network is getting another friend, and I wanted to share the experience of setting everything up with you.  \nI already had a site-to-site VPN setup using Wireguard between three sites, but there was a little problem: I had to set up static routes between these sites. (And maintaining static routes is a big chore, a task no network administrator would like to be involved in).\n\n<img src=\"/posts/vyos-ospf-wireguard/cover.svg\" alt=\"Three routers connected over WAN\" className=\"\"/>\n\n## Meet OSPF\n\nOSPF is a routing protocol that operates inside an autonomous system (AS). OSPF is a link-state protocol that means that every router in the network knows the entire topology of the network. Each router calculates the best next hops from itself to every other possible destination. The list of best next-hops gets appended to the routing table.\n\nOSPF networks are broken apart into _areas_. Area 0 (also called backbone area) is a particular type of OSPF area to which all other areas are connected. Routers in an area form adjacencies when they detect each other.\n\nOSPF supports different operation modes, depending on what interface it is running on. The default operation mode is _broadcast_. Wireguard is an L3 point-to-point tunnel, which means we can't use broadcast. We have to resort to using the [\"point-to-point\"](https://datatracker.ietf.org/doc/html/rfc2328#page-130) operation mode.\n\nIt looks like the perfect candidate for our purposes. Another option we could use is RIP which has some advantages over OSPF in terms of resource utilization on the machine(s) running it but consumes more bandwidth since it transmits the entire routing table every 30 seconds. OSPF, on the other hand, sends only the entries of the routing table that changed.\n\n## Network topology\n\nThe network has three routers in three different sites, connected with Wireguard over the internet. Each router connects to several networks. Only a subset of these networks should be advertised to other routers.\n\n![Network diagram](/posts/vyos-ospf-wireguard/netdiag1.svg)\n\n## Preparation\n\nFirst things firsts, we have to establish the needed Wireguard tunnels.\nWe are adding an interface for each router pair for a specific reason: we need to set `AllowedIPs` to `0.0.0.0/0` for every peer. Wireguard [doesn't support](https://lists.zx2c4.com/pipermail/wireguard/2018-December/003704.html) having the same `AllowedIPs` on multiple peers on the same interface.\n\nQuoting Wireguard's homepage:\n\n> ...when sending packets, the list of allowed IPs behaves as a sort of routing table, and when receiving packets, the list of allowed IPs behaves as a sort of access control list....\n\nSince we have three routers, we have to configure six interfaces, two for each router, spanning three point-to-point subnets.\n\nAs a first step, we decide on our subnets respecting [RFC1918](https://datatracker.ietf.org/doc/html/rfc1818). In my case, I can start playing with `192.168.69.0/24`.\n\n```\n                                             V\n192.168. 69.  0    11000000.10101000.01000101.00000000\n\n# Let's make 3 /30 subnets\n                                                    V\n192.168. 69.  0    11000000.10101000.01000101.000000 00\n192.168. 69.  4    11000000.10101000.01000101.000001 00\n192.168. 69.  8    11000000.10101000.01000101.000010 00\n```\n\nWe can now start configuring our VyOS routers (I'm assuming you already have SSH or console access to the router and a WAN connection).\n\nSSH to rtr-01:\n\n```bash\nrtr-01 $ generate wireguard named-keypairs link_01_to_02\nrtr-01 $ generate wireguard named-keypairs link_01_to_03\n\n# Take note of the pubkeys\nrtr-01 $ show wireguard keypairs pubkey link_01_to_02\nrtr-01 $ show wireguard keypairs pubkey link_01_to_03\n\nrtr-01 $ configure\n\nrtr-01 # edit interfaces wireguard wg01\nrtr-01 # set address 192.168.69.1/30\nrtr-01 # set private-key link_01_to_02\nrtr-01 # set port 7878\nrtr-01 # set description link_01_to_02\nrtr-01 # set peer rtr-02 allowed-ips 0.0.0.0/0\nrtr-01 # set peer rtr-02 pubkey <link_02_to_01 pubkey>\n\nrtr-01 # top\n\nrtr-01 # edit interfaces wireguard wg02\nrtr-01 # set address 192.168.69.5/30\nrtr-01 # set private-key link_01_to_03\nrtr-01 # set port 7879\nrtr-01 # set description link_01_to_03\nrtr-01 # set peer rtr-02 allowed-ips 0.0.0.0/0\nrtr-01 # set peer rtr-02 pubkey <link_03_to_01 pubkey>\n\nrtr-01 # commit; save; exit\n```\n\nNow SSH to the other routers and apply the \"same\" configuration, changing addresses, ports and keys. To streamline the task, you can use your preferred automation tool. I'm using [Ansible](https://www.ansible.com).\n\nDon't forget to allow the used ports on your firewall configuration.\n\nAt this time, you should be able to ping other routers connected at the other end of the tunnels. If everything is working, we can get to the OSPF configuration.\n\n## A _sprinkle_ of OSPF\n\nAs we stated, we have to configure our interfaces to run OSPF In point-to-point mode. Get a shell onto your router and:\n\n```\nrtr-01 $ configure\nrtr-01 # edit interfaces wireguard wg01\nrtr-01 # set ip ospf network point-to-point\nrtr-01 # top\nrtr-01 # copy interfaces wireguard wg01 ip to interfaces wireguard wg02 ip\nrtr-01 # commit; save; exit\n```\n\nFollow the same steps on your other routers. Now we are at the fun part!\n\nWe are adding the 0.0.0.0 area on every router, telling the OSPF daemon which point-to-point networks are part of this area, and telling what routes the router should redistribute to every other router.\n\nYou know the drill, SSH to your favorite router first, and tell it what to do! Then, configure the other routers like this first one.\n\n```\nrtr-01 $ configure\nrtr-01 # edit protocols ospf area 0.0.0.0\nrtr-01 # set network 192.168.69.0/30\nrtr-01 # set network 192.168.69.4/30\nrtr-01 # set network 192.168.69.8/30\nrtr-01 # set redistribute connected\nrtr-01 # commit; save; exit\n```\n\nI'm not covering how to set up your firewall here since your configuration might be different than mine (I'm using zone-based firewall policies). Remember to accept traffic (from and to) the previously defined Wireguard interfaces.\n\n## Let's check if everything is in its place\n\nAt this point, everything should be working.  \nLet's check:\n\n1. if the neighboring relationships are getting formed;\n2. if the link-state database is getting populated;\n3. if routes are getting injected into the routing table.\n\n### Neighboring relationships\n\n```\nrtr-01 $ show ip ospf neighbor\n```\n\n### Link-state database\n\n```\nrtr-01 $ show ip ospf database\n```\n\n### Routes\n\n```\nrtr-01 $ show ip route ospf\n```\n\n## Filtering routes\n\nWe can use a routing policy to filter the redistributed routes from our routers.\nA route map allows us to match a network or an interface (or an as-path, an extcommunity, a metric, a peer, a community, etc.).\nFor our purposes, we will permit the redistribution of networks attached to some interfaces.\n\nLet's create a new policy:\n\n```\nrtr-01 $ configure\nrtr-01 # edit policy route-map FilteredRoutes\nrtr-01 # set rule 10 action permit\nrtr-01 # set rule 10 match interface eth1\nrtr-01 # commit\n```\n\nAnd now apply this policy to the redistribution configuration of the OSPF daemon:\n\n```\nrtr-01 # top\nrtr-01 # edit protocols ospf redistribute connected\nrtr-01 # set route-map FilteredRoutes\nrtr-01 # commit; save; exit\n```\n\n## Bonus: (s)NAT\n\nLet's say you want to access a web server that sits in a network redistributed by `rtr-02` from a client in a network attached to `rtr-01`, but we configured this router to don't redistribute that network.\nIn this case, SNAT is our friend. We are going to translate the source address of our client to the address of the interface connected to `rtr-02`.\n\n![Network diagram](/posts/vyos-ospf-wireguard/netdiag2.svg)\n\nLet's add this NAT rule to `rtr-01`.\n\n```\nrtr-01 $ configure\nrtr-01 # edit nat source\nrtr-01 # set rule 100 outbound-interface wg01\nrtr-01 # set rule 100 source address 192.168.16.0/24 # Change with your network.\nrtr-01 # commit; save; exit\n```\n\n## Final checks\n\n### Neighboring relationships\n\n```\nrtr-01 $ show ip ospf neighbor\n```\n\n### Link-state database\n\n```\nrtr-01 $ show ip ospf database\n```\n\n### Routes\n\n```\nrtr-01 $ show ip route ospf\n```\n\nYou can see that the link state database and, consequently, the routing table are leaner than before since we have fewer routes advertised between our routers.\n\n## Conclusion\n\n![An image of Adele the singer, with \"Hello from your OSPF neighbor\" superimposed](/posts/vyos-ospf-wireguard/hello-from-your-ospf-neighbor.jpg)\n\nAnd we are golden!  \nEnjoy your brand new site-to-site VPN, and forget about adding static routes manually. OSPF will take care of that for you.\n",
      "code": "var Component=(()=>{var l=Object.create;var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var w=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),m=(r,e)=>{for(var n in e)i(r,n,{get:e[n],enumerable:!0})},a=(r,e,n,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let o of u(e))!f.call(r,o)&&o!==n&&i(r,o,{get:()=>e[o],enumerable:!(s=p(e,o))||s.enumerable});return r};var b=(r,e,n)=>(n=r!=null?l(g(r)):{},a(e||!r||!r.__esModule?i(n,\"default\",{value:r,enumerable:!0}):n,r)),k=r=>a(i({},\"__esModule\",{value:!0}),r);var c=w((P,h)=>{h.exports=_jsx_runtime});var S={};m(S,{default:()=>_,frontmatter:()=>y});var t=b(c()),y={title:\"OSPF over Wireguard with VyOS\",date:\"2022-09-29\",excerpt:\"Avoiding static routes because I'm lazy and I wanted to lab a bit\",previewImgUrl:\"https://eliseomartelli.it/posts/vyos-ospf-wireguard/social.png\",tags:[\"Network\"]};function d(r){let e=Object.assign({p:\"p\",br:\"br\",h2:\"h2\",em:\"em\",a:\"a\",img:\"img\",code:\"code\",blockquote:\"blockquote\",pre:\"pre\",ol:\"ol\",li:\"li\",h3:\"h3\"},r.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"My home network is getting another friend, and I wanted to share the experience of setting everything up with you.\",(0,t.jsx)(e.br,{}),`\n`,\"I already had a site-to-site VPN setup using Wireguard between three sites, but there was a little problem: I had to set up static routes between these sites. (And maintaining static routes is a big chore, a task no network administrator would like to be involved in).\"]}),`\n`,(0,t.jsx)(\"img\",{src:\"/posts/vyos-ospf-wireguard/cover.svg\",alt:\"Three routers connected over WAN\",className:\"\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Meet OSPF\"}),`\n`,(0,t.jsx)(e.p,{children:\"OSPF is a routing protocol that operates inside an autonomous system (AS). OSPF is a link-state protocol that means that every router in the network knows the entire topology of the network. Each router calculates the best next hops from itself to every other possible destination. The list of best next-hops gets appended to the routing table.\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"OSPF networks are broken apart into \",(0,t.jsx)(e.em,{children:\"areas\"}),\". Area 0 (also called backbone area) is a particular type of OSPF area to which all other areas are connected. Routers in an area form adjacencies when they detect each other.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"OSPF supports different operation modes, depending on what interface it is running on. The default operation mode is \",(0,t.jsx)(e.em,{children:\"broadcast\"}),\". Wireguard is an L3 point-to-point tunnel, which means we can't use broadcast. We have to resort to using the \",(0,t.jsx)(e.a,{href:\"https://datatracker.ietf.org/doc/html/rfc2328#page-130\",children:'\"point-to-point\"'}),\" operation mode.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"It looks like the perfect candidate for our purposes. Another option we could use is RIP which has some advantages over OSPF in terms of resource utilization on the machine(s) running it but consumes more bandwidth since it transmits the entire routing table every 30 seconds. OSPF, on the other hand, sends only the entries of the routing table that changed.\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Network topology\"}),`\n`,(0,t.jsx)(e.p,{children:\"The network has three routers in three different sites, connected with Wireguard over the internet. Each router connects to several networks. Only a subset of these networks should be advertised to other routers.\"}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"/posts/vyos-ospf-wireguard/netdiag1.svg\",alt:\"Network diagram\"})}),`\n`,(0,t.jsx)(e.h2,{children:\"Preparation\"}),`\n`,(0,t.jsxs)(e.p,{children:[`First things firsts, we have to establish the needed Wireguard tunnels.\nWe are adding an interface for each router pair for a specific reason: we need to set `,(0,t.jsx)(e.code,{children:\"AllowedIPs\"}),\" to \",(0,t.jsx)(e.code,{children:\"0.0.0.0/0\"}),\" for every peer. Wireguard \",(0,t.jsx)(e.a,{href:\"https://lists.zx2c4.com/pipermail/wireguard/2018-December/003704.html\",children:\"doesn't support\"}),\" having the same \",(0,t.jsx)(e.code,{children:\"AllowedIPs\"}),\" on multiple peers on the same interface.\"]}),`\n`,(0,t.jsx)(e.p,{children:\"Quoting Wireguard's homepage:\"}),`\n`,(0,t.jsxs)(e.blockquote,{children:[`\n`,(0,t.jsx)(e.p,{children:\"...when sending packets, the list of allowed IPs behaves as a sort of routing table, and when receiving packets, the list of allowed IPs behaves as a sort of access control list....\"}),`\n`]}),`\n`,(0,t.jsx)(e.p,{children:\"Since we have three routers, we have to configure six interfaces, two for each router, spanning three point-to-point subnets.\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"As a first step, we decide on our subnets respecting \",(0,t.jsx)(e.a,{href:\"https://datatracker.ietf.org/doc/html/rfc1818\",children:\"RFC1918\"}),\". In my case, I can start playing with \",(0,t.jsx)(e.code,{children:\"192.168.69.0/24\"}),\".\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`                                             V\n192.168. 69.  0    11000000.10101000.01000101.00000000\n\n# Let's make 3 /30 subnets\n                                                    V\n192.168. 69.  0    11000000.10101000.01000101.000000 00\n192.168. 69.  4    11000000.10101000.01000101.000001 00\n192.168. 69.  8    11000000.10101000.01000101.000010 00\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"We can now start configuring our VyOS routers (I'm assuming you already have SSH or console access to the router and a WAN connection).\"}),`\n`,(0,t.jsx)(e.p,{children:\"SSH to rtr-01:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:\"language-bash\",children:`rtr-01 $ generate wireguard named-keypairs link_01_to_02\nrtr-01 $ generate wireguard named-keypairs link_01_to_03\n\n# Take note of the pubkeys\nrtr-01 $ show wireguard keypairs pubkey link_01_to_02\nrtr-01 $ show wireguard keypairs pubkey link_01_to_03\n\nrtr-01 $ configure\n\nrtr-01 # edit interfaces wireguard wg01\nrtr-01 # set address 192.168.69.1/30\nrtr-01 # set private-key link_01_to_02\nrtr-01 # set port 7878\nrtr-01 # set description link_01_to_02\nrtr-01 # set peer rtr-02 allowed-ips 0.0.0.0/0\nrtr-01 # set peer rtr-02 pubkey <link_02_to_01 pubkey>\n\nrtr-01 # top\n\nrtr-01 # edit interfaces wireguard wg02\nrtr-01 # set address 192.168.69.5/30\nrtr-01 # set private-key link_01_to_03\nrtr-01 # set port 7879\nrtr-01 # set description link_01_to_03\nrtr-01 # set peer rtr-02 allowed-ips 0.0.0.0/0\nrtr-01 # set peer rtr-02 pubkey <link_03_to_01 pubkey>\n\nrtr-01 # commit; save; exit\n`})}),`\n`,(0,t.jsxs)(e.p,{children:[`Now SSH to the other routers and apply the \"same\" configuration, changing addresses, ports and keys. To streamline the task, you can use your preferred automation tool. I'm using `,(0,t.jsx)(e.a,{href:\"https://www.ansible.com\",children:\"Ansible\"}),\".\"]}),`\n`,(0,t.jsx)(e.p,{children:\"Don't forget to allow the used ports on your firewall configuration.\"}),`\n`,(0,t.jsx)(e.p,{children:\"At this time, you should be able to ping other routers connected at the other end of the tunnels. If everything is working, we can get to the OSPF configuration.\"}),`\n`,(0,t.jsxs)(e.h2,{children:[\"A \",(0,t.jsx)(e.em,{children:\"sprinkle\"}),\" of OSPF\"]}),`\n`,(0,t.jsx)(e.p,{children:\"As we stated, we have to configure our interfaces to run OSPF In point-to-point mode. Get a shell onto your router and:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ configure\nrtr-01 # edit interfaces wireguard wg01\nrtr-01 # set ip ospf network point-to-point\nrtr-01 # top\nrtr-01 # copy interfaces wireguard wg01 ip to interfaces wireguard wg02 ip\nrtr-01 # commit; save; exit\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"Follow the same steps on your other routers. Now we are at the fun part!\"}),`\n`,(0,t.jsx)(e.p,{children:\"We are adding the 0.0.0.0 area on every router, telling the OSPF daemon which point-to-point networks are part of this area, and telling what routes the router should redistribute to every other router.\"}),`\n`,(0,t.jsx)(e.p,{children:\"You know the drill, SSH to your favorite router first, and tell it what to do! Then, configure the other routers like this first one.\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ configure\nrtr-01 # edit protocols ospf area 0.0.0.0\nrtr-01 # set network 192.168.69.0/30\nrtr-01 # set network 192.168.69.4/30\nrtr-01 # set network 192.168.69.8/30\nrtr-01 # set redistribute connected\nrtr-01 # commit; save; exit\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"I'm not covering how to set up your firewall here since your configuration might be different than mine (I'm using zone-based firewall policies). Remember to accept traffic (from and to) the previously defined Wireguard interfaces.\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Let's check if everything is in its place\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"At this point, everything should be working.\",(0,t.jsx)(e.br,{}),`\n`,\"Let's check:\"]}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsx)(e.li,{children:\"if the neighboring relationships are getting formed;\"}),`\n`,(0,t.jsx)(e.li,{children:\"if the link-state database is getting populated;\"}),`\n`,(0,t.jsx)(e.li,{children:\"if routes are getting injected into the routing table.\"}),`\n`]}),`\n`,(0,t.jsx)(e.h3,{children:\"Neighboring relationships\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip ospf neighbor\n`})}),`\n`,(0,t.jsx)(e.h3,{children:\"Link-state database\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip ospf database\n`})}),`\n`,(0,t.jsx)(e.h3,{children:\"Routes\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip route ospf\n`})}),`\n`,(0,t.jsx)(e.h2,{children:\"Filtering routes\"}),`\n`,(0,t.jsx)(e.p,{children:`We can use a routing policy to filter the redistributed routes from our routers.\nA route map allows us to match a network or an interface (or an as-path, an extcommunity, a metric, a peer, a community, etc.).\nFor our purposes, we will permit the redistribution of networks attached to some interfaces.`}),`\n`,(0,t.jsx)(e.p,{children:\"Let's create a new policy:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ configure\nrtr-01 # edit policy route-map FilteredRoutes\nrtr-01 # set rule 10 action permit\nrtr-01 # set rule 10 match interface eth1\nrtr-01 # commit\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"And now apply this policy to the redistribution configuration of the OSPF daemon:\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 # top\nrtr-01 # edit protocols ospf redistribute connected\nrtr-01 # set route-map FilteredRoutes\nrtr-01 # commit; save; exit\n`})}),`\n`,(0,t.jsx)(e.h2,{children:\"Bonus: (s)NAT\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"Let's say you want to access a web server that sits in a network redistributed by \",(0,t.jsx)(e.code,{children:\"rtr-02\"}),\" from a client in a network attached to \",(0,t.jsx)(e.code,{children:\"rtr-01\"}),`, but we configured this router to don't redistribute that network.\nIn this case, SNAT is our friend. We are going to translate the source address of our client to the address of the interface connected to `,(0,t.jsx)(e.code,{children:\"rtr-02\"}),\".\"]}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"/posts/vyos-ospf-wireguard/netdiag2.svg\",alt:\"Network diagram\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"Let's add this NAT rule to \",(0,t.jsx)(e.code,{children:\"rtr-01\"}),\".\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ configure\nrtr-01 # edit nat source\nrtr-01 # set rule 100 outbound-interface wg01\nrtr-01 # set rule 100 source address 192.168.16.0/24 # Change with your network.\nrtr-01 # commit; save; exit\n`})}),`\n`,(0,t.jsx)(e.h2,{children:\"Final checks\"}),`\n`,(0,t.jsx)(e.h3,{children:\"Neighboring relationships\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip ospf neighbor\n`})}),`\n`,(0,t.jsx)(e.h3,{children:\"Link-state database\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip ospf database\n`})}),`\n`,(0,t.jsx)(e.h3,{children:\"Routes\"}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`rtr-01 $ show ip route ospf\n`})}),`\n`,(0,t.jsx)(e.p,{children:\"You can see that the link state database and, consequently, the routing table are leaner than before since we have fewer routes advertised between our routers.\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Conclusion\"}),`\n`,(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:\"/posts/vyos-ospf-wireguard/hello-from-your-ospf-neighbor.jpg\",alt:'An image of Adele the singer, with \"Hello from your OSPF neighbor\" superimposed'})}),`\n`,(0,t.jsxs)(e.p,{children:[\"And we are golden!\",(0,t.jsx)(e.br,{}),`\n`,\"Enjoy your brand new site-to-site VPN, and forget about adding static routes manually. OSPF will take care of that for you.\"]})]})}function v(r={}){let{wrapper:e}=r.components||{};return e?(0,t.jsx)(e,Object.assign({},r,{children:(0,t.jsx)(d,r)})):d(r)}var _=v;return k(S);})();\n;return Component;"
    },
    "_id": "blog/vyos-ospf-wireguard.md",
    "_raw": {
      "sourceFilePath": "blog/vyos-ospf-wireguard.md",
      "sourceFileName": "vyos-ospf-wireguard.md",
      "sourceFileDir": "blog",
      "contentType": "markdown",
      "flattenedPath": "blog/vyos-ospf-wireguard"
    },
    "type": "Post",
    "url": "blog/vyos-ospf-wireguard",
    "timeToRead": "6"
  }
]