{
  "title": "How to use pfSense to load balance between two ISPs",
  "excerpt": "Internet goes brrrrr with multiple WANs",
  "date": "2020-04-05T00:00:00.000Z",
  "tags": [
    "Network"
  ],
  "body": {
    "raw": "\nToday's post aims at helping people that are working/studying from home and don't have a stable internet conection.  \nSince me and my family are currently _staying at home_ we are **taxing our ADSL2+** connection very hard with multiple simultaneous video conferences, so I had to find a way to keep all my family online.  \nThe way I've chosen to do that is using **multiple WANs**, one of them being over **LTE**.\n\n<a href=\"https://ibb.co/DWQNfqz\"><img src=\"https://i.ibb.co/LR1MdGY/Untitled-Artwork.png\" alt=\"Untitled-Artwork\" border=\"0\"/></a>\n\n## Prerequisites\n\n1. A pfSense box with **3+ network interfaces**;\n2. A WAN and a LAN interface already configured inside pfSense;\n3. A **4G/LTE modem** that connects over ethernet.\n\nIf you already have the prerequisites sorted out, let's get to balancing!\n\n## Configure the additional interface\n\nTo start the _journey_ in load balancing, we'll start by telling our pfSense box where to find the interface that we will later use to connect our LTE router.\n\n<a href=\"https://ibb.co/5TcLbHh\"><img src=\"https://i.ibb.co/tBCDVrp/Screenshot-2020-04-05-at-21-36-07.png\" alt=\"Screenshot-2020-04-05-at-21-36-07\" border=\"0\"/></a>\n\nTo add an interface you need to open the **Assingnment** menu under **Interfaces**, select the desidered interface in the dropdown menu, and then click **add**.\n\n<a href=\"https://ibb.co/rt33d3Z\"><img src=\"https://i.ibb.co/wL77c7K/Screenshot-2020-04-05-at-21-36-51.png\" alt=\"Screenshot-2020-04-05-at-21-36-51\" border=\"0\"/></a>\n\nWe can now **configure** the chosen interface and assing it a name. In my case I had to setup the address of this interface with DHCP.\n\nNow it's a right time to **plug** our 4G/LTE modem to our pfSense box.\n\nAt the bottom of the page I checked block private and bogus networks, then you can hit **save** and reload the configuration.\n\n## Setup a multi-gateway\n\nWe're almost there!  \nWe have to **create a multi-gateway** that we'll later use to route our traffic through.\n\n<a href=\"https://ibb.co/0VXCMSH\"><img src=\"https://i.ibb.co/yBR6y1H/Screenshot-2020-04-05-at-21-38-53.png\" alt=\"Screenshot-2020-04-05-at-21-38-53\" border=\"0\"/></a>\n\nWe need to set a network tier, remember that a **lower** number is **preferred**.  \nIf both interfaces share the same network tier, pfSense will balance packets on both of them.  \nRemember to change the \"Trigger Level\" to \"Packet Loss or High Latency\" so you will always use the best connection.\n\n### Configure the firewall to use the multi-gateway\n\nThat's our **last step**!\nThe last thing to do is to configure our LAN firewall to **route** connections to our new _gateway group_.  \nWe need to open the **Rules** page of our firewall, select our **LAN** interface.\n\nOur rule will be a **\"Pass\"** rule that will be configured as following:\n\n```\nInterface: Lan\nProtocol: Any\nSource: Any\nDestination: Any\n```\n\n<a href=\"https://ibb.co/fdqV7kv\"><img src=\"https://i.ibb.co/4RKwx8d/Screenshot-2020-04-05-at-21-40-58.png\" alt=\"Screenshot-2020-04-05-at-21-40-58\" border=\"0\"/></a>\n\nThe last thing to do is going to the **advanced** section of our firewall rule and set the **gateway** to the previously created gateway group.\n\n<a href=\"https://ibb.co/Jy7SPvd\"><img src=\"https://i.ibb.co/Hxz9Qt2/Screenshot-2020-04-05-at-21-41-14.png\" alt=\"Screenshot-2020-04-05-at-21-41-14\" border=\"0\"/></a>\n\nWe're finally done!  \nYou can now go and test your load balanced network!\n",
    "code": "var Component=(()=>{var d=Object.create;var i=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var f=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),m=(n,e)=>{for(var r in e)i(n,r,{get:e[r],enumerable:!0})},c=(n,e,r,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let o of u(e))!b.call(n,o)&&o!==r&&i(n,o,{get:()=>e[o],enumerable:!(a=g(e,o))||a.enumerable});return n};var w=(n,e,r)=>(r=n!=null?d(p(n)):{},c(e||!n||!n.__esModule?i(r,\"default\",{value:n,enumerable:!0}):r,n)),y=n=>c(i({},\"__esModule\",{value:!0}),n);var s=f((v,h)=>{h.exports=_jsx_runtime});var x={};m(x,{default:()=>k,frontmatter:()=>S});var t=w(s()),S={title:\"How to use pfSense to load balance between two ISPs\",date:\"2020-04-05\",excerpt:\"Internet goes brrrrr with multiple WANs\",tags:[\"Network\"]};function l(n){let e=Object.assign({p:\"p\",br:\"br\",em:\"em\",strong:\"strong\",h2:\"h2\",ol:\"ol\",li:\"li\",h3:\"h3\",pre:\"pre\",code:\"code\"},n.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:[\"Today's post aims at helping people that are working/studying from home and don't have a stable internet conection.\",(0,t.jsx)(e.br,{}),`\n`,\"Since me and my family are currently \",(0,t.jsx)(e.em,{children:\"staying at home\"}),\" we are \",(0,t.jsx)(e.strong,{children:\"taxing our ADSL2+\"}),\" connection very hard with multiple simultaneous video conferences, so I had to find a way to keep all my family online.\",(0,t.jsx)(e.br,{}),`\n`,\"The way I've chosen to do that is using \",(0,t.jsx)(e.strong,{children:\"multiple WANs\"}),\", one of them being over \",(0,t.jsx)(e.strong,{children:\"LTE\"}),\".\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/DWQNfqz\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/LR1MdGY/Untitled-Artwork.png\",alt:\"Untitled-Artwork\",border:\"0\"})}),`\n`,(0,t.jsx)(e.h2,{children:\"Prerequisites\"}),`\n`,(0,t.jsxs)(e.ol,{children:[`\n`,(0,t.jsxs)(e.li,{children:[\"A pfSense box with \",(0,t.jsx)(e.strong,{children:\"3+ network interfaces\"}),\";\"]}),`\n`,(0,t.jsx)(e.li,{children:\"A WAN and a LAN interface already configured inside pfSense;\"}),`\n`,(0,t.jsxs)(e.li,{children:[\"A \",(0,t.jsx)(e.strong,{children:\"4G/LTE modem\"}),\" that connects over ethernet.\"]}),`\n`]}),`\n`,(0,t.jsx)(e.p,{children:\"If you already have the prerequisites sorted out, let's get to balancing!\"}),`\n`,(0,t.jsx)(e.h2,{children:\"Configure the additional interface\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"To start the \",(0,t.jsx)(e.em,{children:\"journey\"}),\" in load balancing, we'll start by telling our pfSense box where to find the interface that we will later use to connect our LTE router.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/5TcLbHh\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/tBCDVrp/Screenshot-2020-04-05-at-21-36-07.png\",alt:\"Screenshot-2020-04-05-at-21-36-07\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"To add an interface you need to open the \",(0,t.jsx)(e.strong,{children:\"Assingnment\"}),\" menu under \",(0,t.jsx)(e.strong,{children:\"Interfaces\"}),\", select the desidered interface in the dropdown menu, and then click \",(0,t.jsx)(e.strong,{children:\"add\"}),\".\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/rt33d3Z\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/wL77c7K/Screenshot-2020-04-05-at-21-36-51.png\",alt:\"Screenshot-2020-04-05-at-21-36-51\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We can now \",(0,t.jsx)(e.strong,{children:\"configure\"}),\" the chosen interface and assing it a name. In my case I had to setup the address of this interface with DHCP.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Now it's a right time to \",(0,t.jsx)(e.strong,{children:\"plug\"}),\" our 4G/LTE modem to our pfSense box.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"At the bottom of the page I checked block private and bogus networks, then you can hit \",(0,t.jsx)(e.strong,{children:\"save\"}),\" and reload the configuration.\"]}),`\n`,(0,t.jsx)(e.h2,{children:\"Setup a multi-gateway\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're almost there!\",(0,t.jsx)(e.br,{}),`\n`,\"We have to \",(0,t.jsx)(e.strong,{children:\"create a multi-gateway\"}),\" that we'll later use to route our traffic through.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/0VXCMSH\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/yBR6y1H/Screenshot-2020-04-05-at-21-38-53.png\",alt:\"Screenshot-2020-04-05-at-21-38-53\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We need to set a network tier, remember that a \",(0,t.jsx)(e.strong,{children:\"lower\"}),\" number is \",(0,t.jsx)(e.strong,{children:\"preferred\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"If both interfaces share the same network tier, pfSense will balance packets on both of them.\",(0,t.jsx)(e.br,{}),`\n`,'Remember to change the \"Trigger Level\" to \"Packet Loss or High Latency\" so you will always use the best connection.']}),`\n`,(0,t.jsx)(e.h3,{children:\"Configure the firewall to use the multi-gateway\"}),`\n`,(0,t.jsxs)(e.p,{children:[\"That's our \",(0,t.jsx)(e.strong,{children:\"last step\"}),`!\nThe last thing to do is to configure our LAN firewall to `,(0,t.jsx)(e.strong,{children:\"route\"}),\" connections to our new \",(0,t.jsx)(e.em,{children:\"gateway group\"}),\".\",(0,t.jsx)(e.br,{}),`\n`,\"We need to open the \",(0,t.jsx)(e.strong,{children:\"Rules\"}),\" page of our firewall, select our \",(0,t.jsx)(e.strong,{children:\"LAN\"}),\" interface.\"]}),`\n`,(0,t.jsxs)(e.p,{children:[\"Our rule will be a \",(0,t.jsx)(e.strong,{children:'\"Pass\"'}),\" rule that will be configured as following:\"]}),`\n`,(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:`Interface: Lan\nProtocol: Any\nSource: Any\nDestination: Any\n`})}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/fdqV7kv\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/4RKwx8d/Screenshot-2020-04-05-at-21-40-58.png\",alt:\"Screenshot-2020-04-05-at-21-40-58\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"The last thing to do is going to the \",(0,t.jsx)(e.strong,{children:\"advanced\"}),\" section of our firewall rule and set the \",(0,t.jsx)(e.strong,{children:\"gateway\"}),\" to the previously created gateway group.\"]}),`\n`,(0,t.jsx)(\"a\",{href:\"https://ibb.co/Jy7SPvd\",children:(0,t.jsx)(\"img\",{src:\"https://i.ibb.co/Hxz9Qt2/Screenshot-2020-04-05-at-21-41-14.png\",alt:\"Screenshot-2020-04-05-at-21-41-14\",border:\"0\"})}),`\n`,(0,t.jsxs)(e.p,{children:[\"We're finally done!\",(0,t.jsx)(e.br,{}),`\n`,\"You can now go and test your load balanced network!\"]})]})}function A(n={}){let{wrapper:e}=n.components||{};return e?(0,t.jsx)(e,Object.assign({},n,{children:(0,t.jsx)(l,n)})):l(n)}var k=A;return y(x);})();\n;return Component;"
  },
  "_id": "blog/pfSense_multiple_wan.md",
  "_raw": {
    "sourceFilePath": "blog/pfSense_multiple_wan.md",
    "sourceFileName": "pfSense_multiple_wan.md",
    "sourceFileDir": "blog",
    "contentType": "markdown",
    "flattenedPath": "blog/pfSense_multiple_wan"
  },
  "type": "Post",
  "url": "blog/pfSense_multiple_wan",
  "timeToRead": "2"
}